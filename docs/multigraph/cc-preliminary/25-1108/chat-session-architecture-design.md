# ะะฟัะตะดะตะปะตะฝะธะต ะฐััะธัะตะบัััั ะฟัะพะตะบัะฐ fedoc multigraph โ 2025-11-08

**ะะฐัะฐ:** 2025-11-08 (10:00 - 10:55)  
**ะฃัะฐััะฝะธะบะธ:** ะะปะตะบัะฐะฝะดั, Claude (Cursor AI)  
**ะฆะตะปั ัะตััะธะธ:** ะะฟัะตะดะตะปะตะฝะธะต ะฐััะธัะตะบัััั ัะฐะทะฒะตัััะฒะฐะฝะธั ะธ ัะตัะฝะพะปะพะณะธัะตัะบะพะณะพ ััะตะบะฐ ะดะปั ะฒะตััะธะธ multigraph

---

## ะะพะฝัะตะบัั ะฝะฐัะฐะปะฐ ัะฐะฑะพัั

### ะััะพะดะฝะพะต ัะพััะพัะฝะธะต
ะะพ ัะตะทัะปััะฐัะฐะผ ะฟัะตะดัะดััะตะน ัะตััะธะธ ([chat-25-1107](../../bb-chats/chat-25-1107-resume-16-37.md)):
- โ ะะฐะทะฐ ะดะฐะฝะฝัั multigraph ัะพะทะดะฐะฝะฐ ะธ ะณะพัะพะฒะฐ (PostgreSQL 16 + Apache AGE)
- โ ะัะฐัั `mg_blocks` ะธ `mg_designs` ะฝะฐัััะพะตะฝั ั ะฝะตะพะฑัะพะดะธะผัะผะธ ะพะณัะฐะฝะธัะตะฝะธัะผะธ
- โ ะะตะปััะธะพะฝะฝะฐั ััะตะผะฐ `mg` ัะพะทะดะฐะฝะฐ
- โ ะะพะด ะฟัะธะปะพะถะตะฝะธั ะฝะต ัะพะทะดะฐะฝ
- ๐ ะะปะฐะฝะธัะพะฒะฐะปะพัั: FastAPI + ะพัะดะตะปัะฝัะต ะบะพะฝัะตะนะฝะตัั + Docker ะพัะบะตัััะพะฒะบะฐ

### ะัะพะฑะปะตะผะฐ
ะ ะฟัะตะดัะดััะตะผ ัะฐัะต ะฟัะตะดะปะฐะณะฐะปะฐัั "ัะตัััะทะฝะฐั" ะฐััะธัะตะบัััะฐ ั FastAPI ะธ ะฝะตัะบะพะปัะบะธะผะธ ะบะพะฝัะตะนะฝะตัะฐะผะธ, ะฝะพ ะฝะต ะฑัะปะธ ัััะตะฝั:
1. **ะะตะฐะปัะฝัะน ััะตะฝะฐัะธะน ะธัะฟะพะปัะทะพะฒะฐะฝะธั** - ะพะดะธะฝะพัะฝัะน ัะฐะทัะฐะฑะพััะธะบ, ะฝะต ะบะพะผะฐะฝะดะฝะฐั ัะฐะฑะพัะฐ
2. **ะะณัะฐะฝะธัะตะฝะธั ัะตััััะพะฒ** - ัะตัะฒะตั ั ะพะณัะฐะฝะธัะตะฝะฝะพะน ะฟะฐะผัััั
3. **ะะพัะตัั ะดะฐะฝะฝัั ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ** - ะทะฐะผะตะฝะฐ ะบะพะฝัะตะนะฝะตัะฐ = ะฟะพัะตัั ะะ
4. **ะขะตะบััะธะน ััะตะบ fedoc** - Flask, ะฟัะพัััะต ัะตัะตะฝะธั

---

## ะฃัะพัะฝะตะฝะธะต ััะตะฑะพะฒะฐะฝะธะน

### ะกัะตะฝะฐัะธะน ะธัะฟะพะปัะทะพะฒะฐะฝะธั
**ะัะฝะพะฒะฝะพะน ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะดะธะฝ ัะฐะทัะฐะฑะพััะธะบ (ะะปะตะบัะฐะฝะดั), ัะฟัะฐะฒะปัััะธะน ะณััะฟะฟะพะน ะฟัะพะตะบัะพะฒ

**ะัะฝะพะฒะฝะพะน workflow:**
```
Cursor AI (ะปะพะบะฐะปัะฝะพ) 
    โ 
MCP-fedoc (ะปะพะบะฐะปัะฝะพ)
    โ HTTP/WebSocket
Backend API (ัะดะฐะปะตะฝะฝัะน ัะตัะฒะตั)
    โ
PostgreSQL (ัะดะฐะปะตะฝะฝัะน ัะตัะฒะตั)
```

**ะะพะฟะพะปะฝะธัะตะปัะฝะพ:** ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะธ ะฟััะผะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั ั ะณัะฐัะพะผ

**ะะ ััะตะฑัะตััั (ัะตะนัะฐั):**
- โ ะะพะผะฐะฝะดะฝะฐั ัะฐะฑะพัะฐ
- โ ะะฐะทะณัะฐะฝะธัะตะฝะธะต ะฟัะฐะฒ ะดะพัััะฟะฐ
- โ ะััะพะบะฐั ะฝะฐะณััะทะบะฐ (ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต)
- โ ะัะฑะปะธัะฝัะน ะดะพัััะฟ ะบ ะฒะตะฑ-ัะฐััะธ

### ะะณัะฐะฝะธัะตะฝะธั ะธะฝััะฐััััะบัััั
1. **ะกะตัะฒะตั ั ะพะณัะฐะฝะธัะตะฝะฝัะผะธ ัะตััััะฐะผะธ** - ะผะธะฝะธะผะธะทะฐัะธั ะบะพะฝัะตะนะฝะตัะพะฒ
2. **ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฒะผะตััะต ั PostgreSQL** - ะฟัะตะดะฟะพััะธัะตะปัะฝะพ ะฒ ะพะดะฝะพะผ ะบะพะฝัะตะนะฝะตัะต
3. **ะกะพััะฐะฝะฝะพััั ะดะฐะฝะฝัั** - ะพะฑะฝะพะฒะปะตะฝะธะต ะฟัะธะปะพะถะตะฝะธั ะฝะต ะดะพะปะถะฝะพ ะทะฐััะฐะณะธะฒะฐัั ะะ
4. **ะัะพััะพัะฐ ะพะฑะฝะพะฒะปะตะฝะธั** - ะทะฐะผะตะฝะฐ ะฐััะตัะฐะบัะฐ ะฑะตะท ะฟะตัะตัะฑะพัะบะธ ะฒัะตะณะพ

### ะขะตัะฝะธัะตัะบะธะต ะฒะพะฟัะพัั
1. Flask vs FastAPI - ะฝัะถะฝะฐ ะปะธ ัะปะพะถะฝะพััั FastAPI ะดะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั?
2. Python vs Java - ะตััั ะปะธ ัะผััะป ะฒ JAR packaging?
3. ะะพะฝะพะปะธั vs ะผะธะบัะพัะตัะฒะธัั - ะฝัะถะฝะพ ะปะธ ัะฐะทะดะตะปะตะฝะธะต ะบะพะฝัะตะนะฝะตัะพะฒ?
4. ะะฑะฝะพะฒะปะตะฝะธะต - ะบะฐะบ ะพะฑะฝะพะฒะปััั ะฑะตะท ะฟะพัะตัะธ ะดะฐะฝะฝัั?

---

## ะะฝะฐะปะธะท ะฒะฐัะธะฐะฝัะพะฒ ะฐััะธัะตะบัััั

### ะะฐัะฝะด 1: ะะฑัะธะต ะฟะพะดัะพะดั (ะดะพ ััะพัะฝะตะฝะธั ััะตะฑะพะฒะฐะฝะธะน)

#### ะะฐัะธะฐะฝั 1A: ะะพะฝะพะปะธัะฝัะน ะบะพะฝัะตะนะฝะตั + Docker Volumes
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Container: fedoc-multigraph    โ
โ  โโ PostgreSQL (volume)         โ
โ  โโ Flask App (ะฒะฝัััะธ ะพะฑัะฐะทะฐ)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```
**ะัะพะฑะปะตะผะฐ:** ะะฑะฝะพะฒะปะตะฝะธะต = ะฟะตัะตัะฑะพัะบะฐ ะพะฑัะฐะทะฐ, ะดะฐะฝะฝัะต ะผะพะณัั ะฟะพัะตัััััั

#### ะะฐัะธะฐะฝั 1B: ะะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ (ัะตะบะพะผะตะฝะดะพะฒะฐะฝ ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพ) โญ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Container 1: PostgreSQL โ โ ะดะฐะฝะฝัะต ะฒ volume, ะะ ะขะะะะะะ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Container 2: Flask App  โ โ ะะะะะะฏะะขะกะฏ ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```
**ะัะตะธะผััะตััะฒะฐ:**
- โ ะกะพััะฐะฝะฝะพััั ะดะฐะฝะฝัั ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฐ
- โ ะัะพััะพะต ะพะฑะฝะพะฒะปะตะฝะธะต (docker pull + restart)
- โ Docker best practices

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ ะะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ (~800 MB RAM)
- โ๏ธ ะัะถะตะฝ docker-compose

### ะะฐัะฝะด 2: ะะฐะผะตะฝะฐ ะฐััะตัะฐะบัะฐ ะฒะฝัััะธ ะบะพะฝัะตะนะฝะตัะฐ

**ะะปััะตะฒะพะต ััะพัะฝะตะฝะธะต ะพั ะฟะพะปัะทะพะฒะฐัะตะปั:**
> "ะั ะฝะต ัะฐััะผะพััะตะปะธ ะฒะฐัะธะฐะฝัั ั ะทะฐะผะตะฝะพะน ะฐััะตัะฐะบัะฐ ะฒะฝัััะธ ะบะพะฝัะตะนะฝะตัะฐ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั. ะะฐะฟัะธะผะตั ะทะฐะผะตะฝะฐ jar-ัะฐะนะปะฐ."

ะญัะพ ะธะทะผะตะฝะธะปะพ ะฟะพะดัะพะด! ะะฐััะผะพััะตะฝั ะฒะฐัะธะฐะฝัั ั ะฟะพััะพัะฝะฝัะผ ะบะพะฝัะตะนะฝะตัะพะผ:

#### ะะฐัะธะฐะฝั 3A: Java JAR + PostgreSQL
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Container (ะะะกะขะะฏะะะซะ)            โ
โ  โโ PostgreSQL (volume ะฒะฝัััะธ)     โ
โ  โโ Java Runtime                   โ
โ     โโ /app/app.jar (bind mount)   โ
โ                                     โ
โ  Supervisor:                       โ
โ    โโ postgres (ะฒัะตะณะดะฐ)            โ
โ    โโ java -jar app.jar (restart)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
    /opt/fedoc/app/app.jar (ัะพัั)
```

**ะะฑะฝะพะฒะปะตะฝะธะต:**
```bash
wget new-version.jar -O /opt/fedoc/app/app.jar
docker exec container supervisorctl restart javaapp
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะดะธะฝ ะบะพะฝัะตะนะฝะตั
- โ JAR ัะฐะนะป = ะตะดะธะฝัะน ะฐััะตัะฐะบั (50-100 MB)
- โ ะัะตะปะฐั ัะตัะฝะพะปะพะณะธั
- โ ะะฐะฝะฝัะต ัะพััะฐะฝััััั (PostgreSQL ะฝะต ะฟะตัะตะทะฐะฟััะบะฐะตััั)

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ JVM ััะตะฑัะตั 400-600 MB RAM (vs Flask 200-300 MB)
- โ๏ธ ะะตะดะปะตะฝะฝัะน ััะฐัั JVM (5-10 ัะตะบ)
- โ๏ธ ะะตัะตัะพะด ะฝะฐ ะฝะพะฒัะน ััะตะบ (fedoc ะฝะฐ Python)
- โ๏ธ ะัะตะผั ัะฐะทัะฐะฑะพัะบะธ ะฑะพะปััะต

#### ะะฐัะธะฐะฝั 3B-1: Python Shiv (.pyz) + PostgreSQL โญโญโญ ะะซะะะะ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Container (ะะะกะขะะฏะะะซะ)            โ
โ  โโ PostgreSQL (volume ะฒะฝัััะธ)     โ
โ  โโ Python 3.11                    โ
โ     โโ /app/app.pyz (bind mount)   โ
โ                                     โ
โ  Supervisor:                       โ
โ    โโ postgres (ะฒัะตะณะดะฐ)            โ
โ    โโ python app.pyz (restart)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
    /opt/fedoc/app/app.pyz (ัะพัั)
```

**ะงัะพ ัะฐะบะพะต Shiv:**
- PEP 441 - ัะฟะฐะบะพะฒะบะฐ Python ะฟัะธะปะพะถะตะฝะธั ะฒ ะธัะฟะพะปะฝัะตะผัะน .pyz (zip) ัะฐะนะป
- ะะบะปััะฐะตั ะฒัะต ะทะฐะฒะธัะธะผะพััะธ
- ะะฐะทะผะตั: 20-50 MB
- ะะฝะฐะปะพะณ JAR ะดะปั Python

**ะะฑะฝะพะฒะปะตะฝะธะต:**
```bash
wget new-version.pyz -O /opt/fedoc/app/app.pyz
docker exec container supervisorctl restart pythonapp
# ะัะตะผั: 2-5 ัะตะบัะฝะด
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะดะธะฝ ะบะพะฝัะตะนะฝะตั (~800 MB RAM)
- โ ะะดะธะฝัะน ะฐััะตัะฐะบั .pyz (30-40 MB)
- โ ะัััััะน ััะฐัั Python (<1 ัะตะบ vs JVM 5-10 ัะตะบ)
- โ ะะตะฝััะต ะฟะฐะผััะธ ัะตะผ Java
- โ ะะฝะฐะบะพะผัะน ััะตะบ (Python/Flask ะบะฐะบ ะฒ fedoc)
- โ ะะฐะฝะฝัะต ัะพััะฐะฝััััั
- โ ะััััะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
- โ ะัะพััะพะน ะพัะบะฐั (ัะพััะฐะฝัะตะผ .pyz.backup)

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ Shiv ะผะตะฝะตะต ัะฐัะฟัะพัััะฐะฝะตะฝ ัะตะผ JAR
- โ๏ธ C-ัะฐััะธัะตะฝะธั (psycopg2) ััะตะฑััั psycopg2-binary

#### ะะฐัะธะฐะฝั 3B-2: Python Wheel + pip install
```
docker exec container bash -c "
  source venv/bin/activate
  pip install --upgrade new-version.whl
"
docker exec container supervisorctl restart pythonapp
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะกัะฐะฝะดะฐััะฝัะน Python packaging

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ ะะพะปะตะต ัะปะพะถะฝัะน ะฟัะพัะตัั ะพะฑะฝะพะฒะปะตะฝะธั
- โ๏ธ ะัะถะตะฝ venv ะฒ ะบะพะฝัะตะนะฝะตัะต
- โ๏ธ ะะตัะบะพะปัะบะพ ัะฐะนะปะพะฒ (wheel + ะทะฐะฒะธัะธะผะพััะธ)

---

## ะกัะฐะฒะฝะธัะตะปัะฝัะน ะฐะฝะฐะปะธะท

### ะขะฐะฑะปะธัะฐ ะฐััะตัะฐะบัะพะฒ

| ะัะธัะตัะธะน | Java JAR | Python Shiv (.pyz) | Python Wheel | Docker Image |
|----------|----------|-------------------|--------------|--------------|
| **ะะฐะทะผะตั** | 50-100 MB | 20-50 MB | 5-20 MB | 500-1000 MB |
| **ะะดะธะฝัะน ัะฐะนะป** | โ | โ | โ | โ |
| **ะะฐะฒะธัะธะผะพััะธ** | ะะบะปััะตะฝั | ะะบะปััะตะฝั | ะัะดะตะปัะฝะพ | ะะบะปััะตะฝั |
| **ะะฑะฝะพะฒะปะตะฝะธะต** | ะะฐะผะตะฝะฐ ัะฐะนะปะฐ | ะะฐะผะตะฝะฐ ัะฐะนะปะฐ | pip install | docker pull |
| **ะัะตะผั ััะฐััะฐ** | 5-10 ัะตะบ | <1 ัะตะบ | <1 ัะตะบ | 2-5 ัะตะบ |
| **RAM** | 400-600 MB | 200-300 MB | 200-300 MB | ะทะฐะฒะธัะธั |
| **ะัะตะปะพััั** | โญโญโญโญโญ | โญโญโญ | โญโญโญโญโญ | โญโญโญโญโญ |

### ะขะฐะฑะปะธัะฐ ะฒะฐัะธะฐะฝัะพะฒ ะฐััะธัะตะบัััั

| ะะฐัะธะฐะฝั | ะะพะฝัะตะนะฝะตัั | RAM | ะะฑะฝะพะฒะปะตะฝะธะต | ะััะตัะฐะบั | ะกัะตะบ | ะัะตะฝะบะฐ |
|---------|-----------|-----|------------|----------|------|--------|
| **1A** ะะพะฝะพะปะธั + Volumes | 1 | 900 MB | ะคะฐะนะปั ะฝะฐ ัะพััะต | ะััะพะดะฝะธะบะธ | Python | โญโญ |
| **1B** ะะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ | 2 | 800 MB | docker pull | Docker Image | Python | โญโญโญ |
| **3A** JAR ะฒ ะผะพะฝะพะปะธัะต | 1 | 1200 MB | ะะฐะผะตะฝะฐ JAR | JAR (50-100 MB) | Java | โญโญ |
| **3B-1** PYZ ะฒ ะผะพะฝะพะปะธัะต | 1 | 800 MB | ะะฐะผะตะฝะฐ .pyz | PYZ (30-40 MB) | Python | โญโญโญ |
| **3B-2** Wheel ะฒ ะผะพะฝะพะปะธัะต | 1 | 800 MB | pip install | Wheel (5-20 MB) | Python | โญโญ |

---

## ะคะธะฝะฐะปัะฝะพะต ัะตัะตะฝะธะต

### ะัะฑัะฐะฝ: ะะฐัะธะฐะฝั 3B-1 (Python Shiv .pyz) โญโญโญ

**ะะปััะตัะฝะฐัะธะฒะฐ:** ะะฐัะธะฐะฝั 1B (ะดะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ) - ะฑะพะปะตะต ะฟัะฐะฒะธะปัะฝะพ ะฐััะธัะตะบัััะฝะพ, ะฝะพ ััะตะฑัะตั +1 ะบะพะฝัะตะนะฝะตั

### ะัะพะณะพะฒะฐั ะฐััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะฃะดะฐะปะตะฝะฝัะน ัะตัะฒะตั (fedoc-server)                         โ
โ                                                           โ
โ  Docker Container: fedoc-multigraph (ะะะกะขะะฏะะะซะ)         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ Supervisor                                          โ โ
โ  โ  โโ PostgreSQL 16 + AGE (port 5432 internal)      โ โ
โ  โ  โ  โโ Data: /var/lib/postgresql/data (volume)    โ โ
โ  โ  โ                                                  โ โ
โ  โ  โโ Flask App (port 8080)                         โ โ
โ  โ     โโ REST API (/api/*)                          โ โ
โ  โ     โโ WebSocket (/ws)                            โ โ
โ  โ     โโ Static Frontend (/, /assets/*)             โ โ
โ  โ                                                     โ โ
โ  โ  App: /app/fedoc-multigraph.pyz (bind mount)     โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                           โ
โ  Host: /opt/fedoc/                                       โ
โ    โโ app/fedoc-multigraph.pyz  โ ะะะะะะะฏะะะซะ          โ
โ    โโ data/ (volume mount)      โ ะะะะกะะกะขะะะขะะซะ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ SSH Tunnel (localhost:8080)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะพะบะฐะปัะฝะฐั ะผะฐัะธะฝะฐ (ัะฐะทัะฐะฑะพัะบะฐ)                          โ
โ                                                           โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ  โ
โ  โ Cursor AI  โโโ MCP-fedoc    โโโ HTTP/WS        โ  โ
โ  โ            โ  โ (localhost)  โ  โ localhost:8080 โ  โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ  โ
โ                          โ                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ะัะฐัะทะตั: http://localhost:8080                    โ โ
โ  โ  - ะะธะทัะฐะปะธะทะฐัะธั ะณัะฐัะฐ                              โ โ
โ  โ  - ะะฒัััะพัะพะฝะฝัั ัะฒัะทั ั MCP ัะตัะตะท WebSocket        โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะฑะพัะฝะพะฒะฐะฝะธะต |
|-----------|-----------|-------------|
| **Backend** | Flask 3.0+ | ะัะพััะพัะฐ, ัะตะบััะธะน ััะตะบ fedoc, ะดะพััะฐัะพัะฝะพ ะดะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั |
| **Frontend** | Vue 3 + Vite | ะขะตะบััะธะน ััะตะบ Graph Viewer, pre-build โ ััะฐัะธะบะฐ |
| **ะะ** | PostgreSQL 16 + AGE | ะะพัะพะฒะฐ, ะณัะฐัะพะฒัะต ะทะฐะฟัะพัั ัะตัะตะท Cypher |
| **ะฃะฟะฐะบะพะฒะบะฐ** | Shiv (.pyz) | ะะดะธะฝัะน ะฐััะตัะฐะบั, Python, ะฑััััะพะต ะพะฑะฝะพะฒะปะตะฝะธะต |
| **ะะฐะทะฒะตัััะฒะฐะฝะธะต** | Docker (ะผะพะฝะพะปะธั) | ะะดะธะฝ ะบะพะฝัะตะนะฝะตั, ะผะธะฝะธะผัะผ ัะตััััะพะฒ |
| **ะัะบะตัััะพะฒะบะฐ** | Supervisor | PostgreSQL + Flask ะฒ ะพะดะฝะพะผ ะบะพะฝัะตะนะฝะตัะต |
| **MCP** | Python (ะปะพะบะฐะปัะฝะพ) | ะะฝัะตะณัะฐัะธั ั Cursor AI |

### ะะพัะตะผั ะะ ะฒัะฑัะฐะฝั ะฐะปััะตัะฝะฐัะธะฒั

**FastAPI ะฒะผะตััะพ Flask:**
- โ ะะทะฑััะพัะฝะฐั ัะปะพะถะฝะพััั ะดะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- โ Async ะฝะต ะฝัะถะตะฝ ะฟัะธ ะผะฐะปะพะน ะฝะฐะณััะทะบะต
- โ ะะพะปััะต ะบะพะดะฐ ะดะปั ะฟัะพัััั ะพะฟะตัะฐัะธะน

**Java ะฒะผะตััะพ Python:**
- โ JVM ััะตะฑัะตั ะฑะพะปััะต RAM (400-600 MB vs 200-300 MB)
- โ ะะตะดะปะตะฝะฝัะน ััะฐัั (5-10 ัะตะบ vs <1 ัะตะบ)
- โ ะะตัะตัะพะด ะฝะฐ ะฝะพะฒัะน ััะตะบ = ะฑะพะปััะต ะฒัะตะผะตะฝะธ
- โ fedoc ัะถะต ะฝะฐ Python

**ะะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ:**
- โ๏ธ +1 ะบะพะฝัะตะนะฝะตั ะฟัะธ ะพะณัะฐะฝะธัะตะฝะฝัั ัะตััััะฐั
- โ๏ธ ะฅะพัั ะฐััะธัะตะบัััะฝะพ ะฟัะฐะฒะธะปัะฝะตะต
- โ ะะพะถะตั ะฑััั ัะฐััะผะพััะตะฝ ะฒ ะฑัะดััะตะผ

---

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
fedoc/
โโโ mgsrc/                         # ะะพะฒัะน ะฟัะพะตะบั multigraph
    โโโ backend/                   # Flask Backend
    โ   โโโ fedoc_multigraph/      # ะัะฝะพะฒะฝะพะน ะฟะฐะบะตั
    โ   โ   โโโ __init__.py
    โ   โ   โโโ app.py             # Flask app entry point
    โ   โ   โโโ api/               # REST API
    โ   โ   โ   โโโ blocks.py      # /api/blocks/*
    โ   โ   โ   โโโ designs.py     # /api/designs/*
    โ   โ   โ   โโโ projects.py    # /api/projects/*
    โ   โ   โโโ websocket/         # WebSocket
    โ   โ   โ   โโโ mcp_bridge.py  # MCP โ Frontend
    โ   โ   โโโ db/                # Database
    โ   โ   โ   โโโ connection.py  # psycopg2 pool
    โ   โ   โ   โโโ queries.py     # Cypher queries
    โ   โ   โโโ static/            # ะกะพะฑัะฐะฝะฝัะน frontend
    โ   โ       โโโ (Vue build output)
    โ   โ
    โ   โโโ setup.py               # ะะปั pip packaging
    โ   โโโ requirements.txt       # ะะฐะฒะธัะธะผะพััะธ
    โ   โโโ build-pyz.sh           # ะกะบัะธะฟั ัะฑะพัะบะธ .pyz
    โ
    โโโ frontend/                  # Vue 3 Frontend
    โ   โโโ src/
    โ   โ   โโโ components/        # Vue ะบะพะผะฟะพะฝะตะฝัั
    โ   โ   โโโ views/             # ะกััะฐะฝะธัั
    โ   โ   โโโ services/          # API, WebSocket clients
    โ   โ   โโโ App.vue
    โ   โโโ package.json
    โ   โโโ vite.config.js         # Build โ ../backend/.../static/
    โ
    โโโ mcp_client/                # MCP-ัะตัะฒะตั (ะปะพะบะฐะปัะฝะพ)
    โ   โโโ handlers/              # ะะฑัะฐะฑะพััะธะบะธ ะบะพะผะฐะฝะด
    โ   โ   โโโ blocks.py
    โ   โ   โโโ designs.py
    โ   โ   โโโ visualizer.py
    โ   โโโ api_client.py          # HTTP client
    โ   โโโ ws_client.py           # WebSocket client
    โ   โโโ server.py              # MCP entry point
    โ
    โโโ docker/
    โ   โโโ Dockerfile.base        # ะะฐะทะพะฒัะน ะพะฑัะฐะท (PostgreSQL + Python + Supervisor)
    โ   โโโ supervisord.conf       # ะะพะฝัะธะณััะฐัะธั Supervisor
    โ   โโโ init.sql               # ะะฝะธัะธะฐะปะธะทะฐัะธั ััะตะผั ะะ
    โ   โโโ entrypoint.sh          # ะัะพะฒะตัะบะฐ ะพะฑะฝะพะฒะปะตะฝะธะน ะฟัะธ ััะฐััะต
    โ
    โโโ deploy/                    # ะกะบัะธะฟัั ัะฐะทะฒะตัััะฒะฐะฝะธั
    โ   โโโ deploy.sh              # ะะตัะฒะพะฝะฐัะฐะปัะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
    โ   โโโ update.sh              # ะะฑะฝะพะฒะปะตะฝะธะต .pyz
    โ   โโโ rollback.sh            # ะัะบะฐั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ
    โ
    โโโ README.md                  # ะะพะบัะผะตะฝัะฐัะธั
```

---

## ะัะพัะตัั ะพะฑะฝะพะฒะปะตะฝะธั ะฟัะธะปะพะถะตะฝะธั

### ะกะฑะพัะบะฐ ะฐััะตัะฐะบัะฐ (.pyz)

```bash
# ะะฐ ะผะฐัะธะฝะต ัะฐะทัะฐะฑะพัะบะธ
cd fedoc/mgsrc/backend

# ะกะพะฑัะฐัั .pyz ัะฐะนะป
./build-pyz.sh 1.2.0

# ะะตะทัะปััะฐั: dist/fedoc-multigraph-1.2.0.pyz (~30-40 MB)
```

### ะะฐะทะฒะตัััะฒะฐะฝะธะต ะพะฑะฝะพะฒะปะตะฝะธั

```bash
# ะกะบัะธะฟั deploy/update.sh
VERSION=1.2.0

# 1. ะะฐะณััะทะธัั ะฝะฐ ัะตัะฒะตั
scp dist/fedoc-multigraph-$VERSION.pyz \
    fedoc-server:/opt/fedoc/app/fedoc-multigraph.pyz.new

# 2. ะะฐ ัะตัะฒะตัะต: ะฐัะพะผะฐัะฝะฐั ะทะฐะผะตะฝะฐ
ssh fedoc-server bash <<EOF
  cd /opt/fedoc/app
  
  # Backup
  cp fedoc-multigraph.pyz fedoc-multigraph.pyz.backup
  
  # ะะฐะผะตะฝะธัั
  mv fedoc-multigraph.pyz.new fedoc-multigraph.pyz
  chmod +x fedoc-multigraph.pyz
  
  # ะะตัะตะทะฐะฟัััะธัั ัะพะปัะบะพ ะฟัะธะปะพะถะตะฝะธะต (PostgreSQL ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัั!)
  docker exec fedoc-multigraph supervisorctl restart pythonapp
  
  # ะัะพะฒะตัะบะฐ
  sleep 3
  docker exec fedoc-multigraph supervisorctl status
EOF
```

**ะัะตะผั ะพะฑะฝะพะฒะปะตะฝะธั:** 2-5 ัะตะบัะฝะด  
**Downtime:** ะะธะฝะธะผะฐะปัะฝัะน (ัะพะปัะบะพ restart ะฟัะธะปะพะถะตะฝะธั)  
**ะะพัะตัั ะดะฐะฝะฝัั:** ะะตั (PostgreSQL ะฝะต ะฟะตัะตะทะฐะฟััะบะฐะตััั)

### ะัะบะฐั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ

```bash
ssh fedoc-server bash <<EOF
  cd /opt/fedoc/app
  mv fedoc-multigraph.pyz fedoc-multigraph.pyz.failed
  mv fedoc-multigraph.pyz.backup fedoc-multigraph.pyz
  docker exec fedoc-multigraph supervisorctl restart pythonapp
EOF
```

---

## Workflow ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### Scenario 1: ะะฐะฑะพัะฐ ัะตัะตะท Cursor AI

```
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒ Cursor: "ะะพะฑะฐะฒั ะฝะพะฒัะน ะฑะปะพะบ 'API Gateway'"

2. Cursor AI โ MCP-fedoc (localhost)

3. MCP ะดะตะปะฐะตั HTTP POST โ http://localhost:8080/api/blocks
   ัะตัะตะท SSH tunnel ะฝะฐ ัะดะฐะปะตะฝะฝัะน ัะตัะฒะตั

4. Flask Backend ะฟะพะปััะฐะตั ะทะฐะฟัะพั

5. Backend ะฒัะฟะพะปะฝัะตั Cypher query โ PostgreSQL/AGE

6. Backend ะพัะฟัะฐะฒะปัะตั WebSocket ัะฒะตะดะพะผะปะตะฝะธะต โ Frontend (ะตัะปะธ ะพัะบััั)

7. Frontend ะพะฑะฝะพะฒะปัะตั ะฒะธะทัะฐะปะธะทะฐัะธั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

8. MCP ะฒะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐั โ Cursor AI โ ะะพะปัะทะพะฒะฐัะตะปั
```

### Scenario 2: ะะฐะฑะพัะฐ ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั

```
1. ะะพะปัะทะพะฒะฐัะตะปั: http://localhost:8080 (ัะตัะตะท SSH tunnel)

2. Frontend (Vue) ะทะฐะณััะถะฐะตััั ะธะท backend/static/

3. ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะทัะฐะปะธะทะธััะตั ะณัะฐั, ะฒัะดะตะปัะตั ัะทะปั

4. WebSocket ะพัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต โ Backend โ MCP

5. MCP ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั ะฒัะดะตะปะตะฝะฝัะต ัะปะตะผะตะฝัั ะฒ Cursor AI
```

### Scenario 3: ะัะดะตะปะตะฝะธะต ัะปะตะผะตะฝัะพะฒ ะฒ Graph Viewer ะดะปั ัะฐะฑะพัั ั MCP

```
1. Cursor AI: "ะะพะบะฐะถะธ ะผะฝะต ะดะพัะตัะฝะธะต ัะปะตะผะตะฝัั ะฒัะดะตะปะตะฝะฝัั ะฑะปะพะบะพะฒ"

2. MCP โ WebSocket โ Backend โ Frontend

3. Frontend ะฒะพะทะฒัะฐัะฐะตั ัะฟะธัะพะบ ะฒัะดะตะปะตะฝะฝัั ัะปะตะผะตะฝัะพะฒ

4. MCP ะฒัะฟะพะปะฝัะตั ะทะฐะฟัะพั ะบ API ั ััะธะผะธ ัะปะตะผะตะฝัะฐะผะธ

5. ะะตะทัะปััะฐั ะฒะพะทะฒัะฐัะฐะตััั ะฒ Cursor AI
```

---

## ะะปััะตะฒัะต ัะตัะตะฝะธั ะธ ะพะฑะพัะฝะพะฒะฐะฝะธั

### 1. ะะพะฝะพะปะธัะฝัะน ะบะพะฝัะตะนะฝะตั ะฒะผะตััะพ ะผะธะบัะพัะตัะฒะธัะพะฒ

**ะะตัะตะฝะธะต:** PostgreSQL + Backend ะฒ ะพะดะฝะพะผ ะบะพะฝัะตะนะฝะตัะต

**ะะฑะพัะฝะพะฒะฐะฝะธะต:**
- ะะดะธะฝ ะฟะพะปัะทะพะฒะฐัะตะปั โ ะฝะตั ะฝะตะพะฑัะพะดะธะผะพััะธ ะฒ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะธ
- ะะณัะฐะฝะธัะตะฝะฝัะต ัะตััััั ัะตัะฒะตัะฐ
- ะัะพััะพัะฐ ัะฐะทะฒะตัััะฒะฐะฝะธั
- Supervisor ะพะฑะตัะฟะตัะธะฒะฐะตั ัะฟัะฐะฒะปะตะฝะธะต ะฟัะพัะตััะฐะผะธ

**Trade-off:**
- โ๏ธ ะะตะฝะตะต ะณะธะฑะบะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต (ะฝะต ะฟัะพะฑะปะตะผะฐ ะดะปั ัะตะบััะตะณะพ use case)
- โ๏ธ ะะต ัะพะพัะฒะตัััะฒัะตั best practices ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ (ะฝะพ ััะพ ะฝะต ะฟัะพะดะฐะบัะตะฝ)

### 2. Flask ะฒะผะตััะพ FastAPI

**ะะตัะตะฝะธะต:** Flask 3.0+

**ะะฑะพัะฝะพะฒะฐะฝะธะต:**
- ะัะพััะพัะฐ ะดะปั ะพะดะธะฝะพัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะขะตะบััะธะน ััะตะบ fedoc
- ะะพััะฐัะพัะฝะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะดะปั ะผะฐะปะพะน ะฝะฐะณััะทะบะธ
- ะะตะฝััะต boilerplate ะบะพะดะฐ

**Trade-off:**
- โ๏ธ ะะตั async/await (ะฝะต ะฝัะถะฝะพ ะฟัะธ ะผะฐะปะพะน ะฝะฐะณััะทะบะต)
- โ๏ธ ะะตั ะฐะฒัะพะณะตะฝะตัะฐัะธะธ OpenAPI (ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ัะตัะตะท flask-swagger ะตัะปะธ ะฟะพะฝะฐะดะพะฑะธััั)

### 3. Python ะฒะผะตััะพ Java

**ะะตัะตะฝะธะต:** Python + Shiv (.pyz)

**ะะฑะพัะฝะพะฒะฐะฝะธะต:**
- ะะฝะฐะบะพะผัะน ััะตะบ (fedoc ะฝะฐ Python)
- ะะตะฝััะต RAM (200-300 MB vs 400-600 MB)
- ะัััััะน ััะฐัั (<1 ัะตะบ vs 5-10 ัะตะบ)
- ะะดะธะฝัะน ะฐััะตัะฐะบั ัะตัะตะท Shiv (ะฐะฝะฐะปะพะณ JAR)
- ะััััะฐั ัะฐะทัะฐะฑะพัะบะฐ

**Trade-off:**
- โ๏ธ ะะตะฝััะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฟัะธ ะฒััะพะบะพะน ะฝะฐะณััะทะบะต (ะฝะต ะฐะบััะฐะปัะฝะพ)
- โ๏ธ Shiv ะผะตะฝะตะต ัะฐัะฟัะพัััะฐะฝะตะฝ ัะตะผ JAR (ะฝะพ ัะฐะฑะพัะฐะตั ะพัะปะธัะฝะพ)

### 4. Shiv (.pyz) ะฒะผะตััะพ Docker Image ะธะปะธ Wheel

**ะะตัะตะฝะธะต:** ะฃะฟะฐะบะพะฒะบะฐ ะฒ .pyz ัะตัะตะท Shiv (PEP 441)

**ะะฑะพัะฝะพะฒะฐะฝะธะต:**
- ะะดะธะฝัะน ัะฐะนะป (~30-40 MB)
- ะัะต ะทะฐะฒะธัะธะผะพััะธ ะฒะบะปััะตะฝั
- ะัะพััะพะต ะพะฑะฝะพะฒะปะตะฝะธะต (ะทะฐะผะตะฝะฐ ัะฐะนะปะฐ)
- ะัััััะน ััะฐัั
- ะะต ััะตะฑัะตั pะตัะตัะฑะพัะบะธ Docker ะพะฑัะฐะทะฐ

**Trade-off:**
- โ๏ธ ะขัะตะฑัะตั Python ะฝะฐ ัะตะปะตะฒะพะน ัะธััะตะผะต (ะตััั ะฒ ะบะพะฝัะตะนะฝะตัะต)
- โ๏ธ C-ัะฐััะธัะตะฝะธั ััะตะฑััั binary wheels (psycopg2-binary)

### 5. Bind mount ะดะปั .pyz ะฒะผะตััะพ ะบะพะฟะธัะพะฒะฐะฝะธั ะฒ ะพะฑัะฐะท

**ะะตัะตะฝะธะต:** /app/ ะผะพะฝัะธััะตััั ั ัะพััะฐ

**ะะฑะพัะฝะพะฒะฐะฝะธะต:**
- ะะฑะฝะพะฒะปะตะฝะธะต ะฑะตะท ะฟะตัะตัะฑะพัะบะธ ะพะฑัะฐะทะฐ
- ะะพะฝัะตะนะฝะตั ะฟะพััะพัะฝะฝัะน โ ะดะฐะฝะฝัะต ะะ ัะพััะฐะฝััััั
- ะัะพััะพะน ะพัะบะฐั (ะทะฐะผะตะฝะฐ ัะฐะนะปะฐ)

**Trade-off:**
- โ๏ธ ะะฐะฒะธัะธะผะพััั ะพั ัะฐะนะปะพะฒะพะน ัะธััะตะผั ัะพััะฐ
- โ๏ธ ะะตะฝะตะต ะธะทะพะปะธัะพะฒะฐะฝะฝะพ (ะฝะพ ะฟัะธะตะผะปะตะผะพ)

---

## ะัะตะฝะบะฐ ัะตััััะพะฒ

### ะะพััะตะฑะปะตะฝะธะต RAM (ะพะถะธะดะฐะตะผะพะต)

| ะะพะผะฟะพะฝะตะฝั | RAM |
|-----------|-----|
| PostgreSQL 16 | ~500 MB |
| Python Flask App | ~200-300 MB |
| Supervisor + OS | ~100 MB |
| **ะัะพะณะพ** | **~800-900 MB** |

### ะะธัะบะพะฒะพะต ะฟัะพัััะฐะฝััะฒะพ

| ะะพะผะฟะพะฝะตะฝั | ะะฐะทะผะตั |
|-----------|--------|
| Docker ะพะฑัะฐะท (base) | ~1.0 GB |
| PostgreSQL data | ~100-500 MB (ัะฐััะตั) |
| .pyz ะฐััะตัะฐะบั | ~30-40 MB |
| ะะพะณะธ | ~10-50 MB |
| **ะัะพะณะพ** | **~1.5-2.0 GB** |

---

## ะะธัะบะธ ะธ ะผะธัะธะณะฐัะธะธ

### ะะธัะบ 1: ะะพะฝัะตะนะฝะตั ะฟะฐะดะฐะตั โ ะดะฐะฝะฝัะต ัะตัััััั?
**ะะธัะธะณะฐัะธั:** Volume ะดะปั /var/lib/postgresql/data, ะดะฐะฝะฝัะต ะฝะฐ ัะพััะต

### ะะธัะบ 2: ะะฑะฝะพะฒะปะตะฝะธะต .pyz ะปะพะผะฐะตั ะฟัะธะปะพะถะตะฝะธะต
**ะะธัะธะณะฐัะธั:** 
- ะกะพััะฐะฝัะตะผ .pyz.backup ะฟะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธะตะผ
- Healthcheck ะฟะพัะปะต update.sh
- ะะฒัะพะผะฐัะธัะตัะบะธะน rollback ะฟัะธ ะพัะธะฑะบะต

### ะะธัะบ 3: PostgreSQL ะธ ะฟัะธะปะพะถะตะฝะธะต ะบะพะฝัะปะธะบัััั ะฒ ะพะดะฝะพะผ ะบะพะฝัะตะนะฝะตัะต
**ะะธัะธะณะฐัะธั:**
- Supervisor ะธะทะพะปะธััะตั ะฟัะพัะตััั
- ะะฐะทะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ (postgres / nobody)
- ะะพะฝะธัะพัะธะฝะณ ัะตัะตะท supervisorctl

### ะะธัะบ 4: ะะณัะฐะฝะธัะตะฝะธั Shiv (C-extensions)
**ะะธัะธะณะฐัะธั:**
- ะัะฟะพะปัะทะพะฒะฐัั psycopg2-binary (pre-compiled)
- ะขะตััะธัะพะฒะฐัั .pyz ะฟะตัะตะด ัะฐะทะฒะตัััะฒะฐะฝะธะตะผ

### ะะธัะบ 5: ะะตะดะพััะฐัะพัะฝะพ ัะตััััะพะฒ ะฝะฐ ัะตัะฒะตัะต
**ะะธัะธะณะฐัะธั:**
- ะะพะฝะธัะพัะธะฝะณ RAM/CPU
- ะะพะทะผะพะถะฝะพััั ะฟะตัะตัะพะดะฐ ะฝะฐ ะะฐัะธะฐะฝั 1B (ะดะฒะฐ ะบะพะฝัะตะนะฝะตัะฐ)
- ะะฐัััะพะนะบะฐ PostgreSQL ะดะปั ะผะฐะปัั ัะตััััะพะฒ

---

## ะะฐะปัะฝะตะนัะธะต ัะฐะณะธ

### ะกะปะตะดัััะฐั ัะตััะธั (ะฟัะธะพัะธัะตั 1)

1. **ะกะพะทะดะฐัั ััััะบัััั mgsrc/**
   ```bash
   mkdir -p mgsrc/{backend,frontend,mcp_client,docker,deploy}
   ```

2. **Backend MVP:**
   - Flask app ั ะฑะฐะทะพะฒัะผ API
   - ะะพะดะบะปััะตะฝะธะต ะบ PostgreSQL ัะตัะตะท psycopg2
   - ะะดะธะฝ endpoint: `POST /api/blocks` (ัะพะทะดะฐะฝะธะต ะฑะปะพะบะฐ)
   - setup.py ะดะปั packaging

3. **Dockerfile ะธ Supervisor:**
   - docker/Dockerfile.base
   - docker/supervisord.conf
   - docker/init.sql

4. **ะกะบัะธะฟั ัะฑะพัะบะธ:**
   - backend/build-pyz.sh
   - ะขะตััะพะฒะฐั ัะฑะพัะบะฐ .pyz

### ะัะธะพัะธัะตั 2

5. **Frontend ะฑะฐะทะพะฒัะน:**
   - Vue 3 + Vite ะฟัะพะตะบั
   - ะะดะฝะฐ ัััะฐะฝะธัะฐ ั ะฒะธะทัะฐะปะธะทะฐัะธะตะน (ะฟัััะพะน ะณัะฐั)
   - ะกะฑะพัะบะฐ ะฒ backend/.../ static/

6. **MCP ะบะปะธะตะฝั:**
   - ะะฐะทะพะฒัะน MCP-ัะตัะฒะตั
   - ะะดะธะฝ handler: ัะพะทะดะฐะฝะธะต ะฑะปะพะบะฐ
   - HTTP client ะดะปั API

### ะัะธะพัะธัะตั 3

7. **ะะฐะทะฒะตัััะฒะฐะฝะธะต:**
   - deploy/deploy.sh - ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
   - deploy/update.sh - ะพะฑะฝะพะฒะปะตะฝะธะต
   - ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ ัะตัะฒะตัะต

8. **WebSocket:**
   - ะะฒัััะพัะพะฝะฝัั ัะฒัะทั MCP โ Frontend
   - ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะธะทะผะตะฝะตะฝะธัั

---

## ะะพะบัะผะตะฝัะฐัะธั

### ะกะพะทะดะฐะฝะฝัะต ะดะพะบัะผะตะฝัั

1. **ะญัะพั ะดะพะบัะผะตะฝั:** ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ะฐััะธัะตะบัััะฝะพะณะพ ัะตัะตะฝะธั
   - ะััั: `docs/multigraph/cc-preliminary/25-1108/chat-session-architecture-design.md`

2. **ะัะฝะพะฒะฝะพะน ะฟัะพะตะบัะฝัะน ะดะพะบัะผะตะฝั:** (ะฑัะดะตั ัะพะทะดะฐะฝ)
   - ะััั: `docs/multigraph/aa-main-docs/aa-project.md`
   - ะกะพะดะตัะถะธั: ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ, ะฐััะธัะตะบัััะฐ, ััะตะบ

3. **ะะตะทัะผะต ัะฐัะฐ:** (ะฑัะดะตั ัะพะทะดะฐะฝ)
   - ะััั: `docs/multigraph/bb-chats/chat-25-1108-resume-10-55.md`
   - ะกะพะดะตัะถะธั: ะัะฐัะบะพะต ัะตะทัะผะต ะดะปั ะฟัะพะดะพะปะถะตะฝะธั ัะฐะฑะพัั

### ะะตะพัะณะฐะฝะธะทะฐัะธั ะดะพะบัะผะตะฝัะฐัะธะธ

**ะัะฟะพะปะฝะตะฝะพ:**
- โ ะกะพะทะดะฐะฝะฐ ะฟะฐะฟะบะฐ `aa-main-docs/` ะดะปั ะพัะฝะพะฒะฝะพะน ะดะพะบัะผะตะฝัะฐัะธะธ
- โ ะกะพะทะดะฐะฝะฐ ะฟะฐะฟะบะฐ `cc-preliminary/` ะดะปั ะฟัะตะดะฒะฐัะธัะตะปัะฝัั ะผะฐัะตัะธะฐะปะพะฒ
- โ ะะตัะตะธะผะตะฝะพะฒะฐะฝะฐ `chats/` โ `bb-chats/`
- โ ะะตัะตะผะตัะตะฝะฐ `25-1107/` โ `cc-preliminary/25-1107/`
- โ ะะฑะฝะพะฒะปะตะฝั ัััะปะบะธ ะฒ ัััะตััะฒัััะธั ะดะพะบัะผะตะฝัะฐั

**ะกัััะบัััะฐ:**
```
docs/multigraph/
โโโ aa-main-docs/          # ะัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โ   โโโ aa-project.md
โโโ bb-chats/              # ะะตะทัะผะต ัะฐัะพะฒ
โ   โโโ chat-25-1107-resume-16-37.md
โ   โโโ chat-25-1108-resume-10-55.md
โโโ cc-preliminary/        # ะัะตะดะฒะฐัะธัะตะปัะฝัะต ะผะฐัะตัะธะฐะปั
    โโโ 25-1107/           # ะกะตััะธั ัะพะทะดะฐะฝะธั ะะ
    โโโ 25-1108/           # ะกะตััะธั ะพะฟัะตะดะตะปะตะฝะธั ะฐััะธัะตะบัััั
        โโโ chat-session-architecture-design.md (ััะพั ะดะพะบัะผะตะฝั)
```

---

## ะัะธะปะพะถะตะฝะธั

### A. ะัะธะผะตั supervisord.conf

```ini
[supervisord]
nodaemon=true
user=root

[program:postgresql]
command=/usr/lib/postgresql/16/bin/postgres -D /var/lib/postgresql/data
user=postgres
autostart=true
autorestart=true
priority=1
stdout_logfile=/var/log/supervisor/postgres.log
stderr_logfile=/var/log/supervisor/postgres_err.log

[program:pythonapp]
command=/usr/bin/python3 /app/fedoc-multigraph.pyz
directory=/app
user=nobody
autostart=true
autorestart=true
priority=10
startsecs=5
stopwaitsecs=30
environment=PYTHONUNBUFFERED=1,DATABASE_URL="postgresql://fedoc:password@localhost:5432/fedoc_mg"
stdout_logfile=/var/log/supervisor/pythonapp.log
stderr_logfile=/var/log/supervisor/pythonapp_err.log

[unix_http_server]
file=/var/run/supervisor.sock

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
```

### B. ะัะธะผะตั build-pyz.sh

```bash
#!/bin/bash
set -e

VERSION=${1:-dev}
OUTPUT_DIR=${2:-dist}

echo "ะกะฑะพัะบะฐ fedoc-multigraph.pyz ะฒะตััะธะธ $VERSION..."

# ะฃััะฐะฝะพะฒะธัั shiv
pip install shiv

# ะกะพะฑัะฐัั frontend
cd ../frontend
npm install
npm run build
cd ../backend

# ะกะพะฑัะฐัั .pyz
shiv \
  --site-packages . \
  --compressed \
  --output-file "$OUTPUT_DIR/fedoc-multigraph-$VERSION.pyz" \
  --entry-point fedoc_multigraph.app:main \
  --python '/usr/bin/env python3' \
  flask psycopg2-binary flask-socketio flask-cors

# Symlink
ln -sf "fedoc-multigraph-$VERSION.pyz" "$OUTPUT_DIR/fedoc-multigraph-latest.pyz"

echo "โ ะกะพะทะดะฐะฝ: $OUTPUT_DIR/fedoc-multigraph-$VERSION.pyz"
ls -lh "$OUTPUT_DIR/fedoc-multigraph-$VERSION.pyz"
```

### C. ะัะธะผะตั deploy/update.sh

```bash
#!/bin/bash
set -e

VERSION=$1
REMOTE_HOST="fedoc-server"
REMOTE_DIR="/opt/fedoc/app"
CONTAINER="fedoc-multigraph"

if [ -z "$VERSION" ]; then
    echo "Usage: $0 <version>"
    exit 1
fi

echo "๐ ะะฑะฝะพะฒะปะตะฝะธะต ะดะพ ะฒะตััะธะธ $VERSION..."

PYZ_FILE="fedoc-multigraph-$VERSION.pyz"

# ะะฐะณััะทะบะฐ ะฝะฐ ัะตัะฒะตั
echo "๐ค ะะฐะณััะทะบะฐ $PYZ_FILE..."
scp "dist/$PYZ_FILE" "$REMOTE_HOST:$REMOTE_DIR/$PYZ_FILE.new"

# ะะฑะฝะพะฒะปะตะฝะธะต ะฝะฐ ัะตัะฒะตัะต
echo "๐ ะัะธะผะตะฝะตะฝะธะต ะพะฑะฝะพะฒะปะตะฝะธั..."
ssh "$REMOTE_HOST" bash <<EOF
    set -e
    cd $REMOTE_DIR
    
    # Backup
    if [ -f fedoc-multigraph.pyz ]; then
        cp fedoc-multigraph.pyz fedoc-multigraph.pyz.backup
    fi
    
    # ะะฐะผะตะฝะธัั
    mv $PYZ_FILE.new fedoc-multigraph.pyz
    chmod +x fedoc-multigraph.pyz
    
    # ะะตัะตะทะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต
    echo "๐ ะะตัะตะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั..."
    docker exec $CONTAINER supervisorctl restart pythonapp
    
    # ะัะพะฒะตัะบะฐ
    sleep 3
    if docker exec $CONTAINER supervisorctl status pythonapp | grep -q RUNNING; then
        echo "โ ะัะธะปะพะถะตะฝะธะต ััะฟะตัะฝะพ ะทะฐะฟััะตะฝะพ"
        # ะัะธััะบะฐ ััะฐััั backup'ะพะฒ (ะพััะฐะฒะปัะตะผ ัะพะปัะบะพ ะฟะพัะปะตะดะฝะธะน)
        ls -t fedoc-multigraph.pyz.backup* 2>/dev/null | tail -n +2 | xargs -r rm
        exit 0
    else
        echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ! ะัะบะฐั..."
        if [ -f fedoc-multigraph.pyz.backup ]; then
            mv fedoc-multigraph.pyz fedoc-multigraph.pyz.failed
            mv fedoc-multigraph.pyz.backup fedoc-multigraph.pyz
            docker exec $CONTAINER supervisorctl restart pythonapp
            echo "๐ ะัะบะฐั ะฒัะฟะพะปะฝะตะฝ"
        fi
        exit 1
    fi
EOF

if [ $? -eq 0 ]; then
    echo "โ ะะฑะฝะพะฒะปะตะฝะธะต ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝะพ!"
else
    echo "โ ะะฑะฝะพะฒะปะตะฝะธะต ะฝะต ัะดะฐะปะพัั"
    exit 1
fi
```

---

## ะะฐะบะปััะตะฝะธะต

ะ ัะตะทัะปััะฐัะต ัะตััะธะธ:

1. โ ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐะฝั 6 ะฐััะธัะตะบัััะฝัั ะฒะฐัะธะฐะฝัะพะฒ
2. โ ะัะฑัะฐะฝะฐ ะพะฟัะธะผะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ ะดะปั ััะตะฝะฐัะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
3. โ ะะฟัะตะดะตะปะตะฝ ัะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ (Flask + Shiv .pyz)
4. โ ะกะฟัะพะตะบัะธัะพะฒะฐะฝะฐ ััััะบัััะฐ ะฟัะพะตะบัะฐ
5. โ ะะฟะธัะฐะฝ ะฟัะพัะตัั ะพะฑะฝะพะฒะปะตะฝะธั ะธ workflow
6. โ ะะฐะดะพะบัะผะตะฝัะธัะพะฒะฐะฝั ะฒัะต ัะตัะตะฝะธั ะธ ะพะฑะพัะฝะพะฒะฐะฝะธั

**ะะพัะพะฒะพ ะบ ัะปะตะดัััะตะผั ััะฐะฟั:** ะะตะฐะปะธะทะฐัะธั MVP ัะพะณะปะฐัะฝะพ ะพะฟัะตะดะตะปะตะฝะฝะพะน ะฐััะธัะตะบัััะต.

---

**ะะฒัะพัั:** ะะปะตะบัะฐะฝะดั, Claude (Cursor AI)  
**ะะฐัะฐ:** 2025-11-08  
**ะะตััะธั:** 1.0

