# Решение 003: Архитектура инструмента визуализации графов

**Дата:** 2025-10-14  
**Статус:** ✅ Принято  
**Участники:** Александр, Claude (Cursor AI)

## Проблема

Штатный Web UI ArangoDB плохо справляется с визуализацией сложных графов проекта.
Требуется инструмент, который:
1. Интегрируется с MCP-сервером для вызова из Cursor AI (приоритет)
2. Работает как CLI для прямого использования
3. Не дублирует код между двумя режимами
4. Является частью проекта fedoc, а не отдельным приложением

## Рассмотренные варианты

### 1. Только в составе MCP-сервера

**Описание:** Viewer как часть MCP-сервера, без CLI

**Плюсы:**
- Единая точка установки
- Простая архитектура

**Минусы:**
- ❌ Нельзя использовать отдельно от MCP
- ❌ Сложнее отлаживать
- ❌ Зависимость от работы MCP-сервера

### 2. Отдельное приложение вне проекта

**Описание:** Независимое приложение в /home/alex/tools/

**Плюсы:**
- Независимое развитие
- Простое использование

**Минусы:**
- ❌ Дублирование кода при интеграции в MCP
- ❌ Не является частью fedoc
- ❌ Сложнее синхронизировать версии

### 3. Библиотека + интеграция (ВЫБРАН)

**Описание:** Viewer как библиотека в src/lib/graph_viewer с двумя точками входа

**Плюсы:**
- ✅ Переиспользование кода (DRY)
- ✅ Два способа вызова (MCP + CLI)
- ✅ Единая кодовая база
- ✅ Часть проекта fedoc
- ✅ Легко поддерживать и расширять

**Минусы:**
- ⚠️ Чуть сложнее начальная настройка

## Решение

Выбран **Вариант 3: Библиотека + интеграция**

### Структура:

```
src/
├── lib/
│   └── graph_viewer/          # Библиотека визуализации
│       ├── __init__.py
│       ├── viewer.py          # Основной класс
│       └── assets/            # JS/CSS
│
├── mcp_server/
│   └── handlers/
│       └── graph_visualizer.py  # Использует lib.graph_viewer
│
dev/
└── tools/
    └── view-graph.sh          # CLI обёртка
```

### Использование:

**1. Через MCP-сервер (приоритет для Cursor AI):**
```
Пользователь → Cursor AI: "Покажи граф проекта FEPRO"
Cursor AI → MCP Server → lib.graph_viewer → Браузер
```

**2. Через CLI:**
```bash
dev/tools/view-graph.sh --project fepro
```

## Реализация

### Библиотека:
```python
# src/lib/graph_viewer/viewer.py
class ArangoGraphViewer:
    def visualize(self, edges, ...):
        # Создание интерактивной визуализации
        ...
```

### MCP обработчик:
```python
# src/mcp_server/handlers/graph_visualizer.py
from lib.graph_viewer import ArangoGraphViewer

def show_graph(project, depth):
    viewer = ArangoGraphViewer(...)
    viewer.visualize(...)
```

### CLI:
```bash
# dev/tools/view-graph.sh
export PYTHONPATH="$PROJECT_ROOT/src:$PYTHONPATH"
python3 -m lib.graph_viewer.viewer "$@"
```

## Последствия

### Положительные:

- ✅ Единая кодовая база - легко поддерживать
- ✅ Гибкость использования (MCP или CLI)
- ✅ Часть проекта fedoc
- ✅ Простое тестирование
- ✅ Легко расширять функциональность

### Отрицательные:

- ⚠️ Требуется настройка PYTHONPATH для CLI
- ⚠️ Зависимость от структуры проекта

## Альтернативы на будущее

- Если MCP не подойдет - легко использовать только CLI
- Если нужен веб-сервис - добавить FastAPI обёртку
- Если нужен desktop app - добавить Electron обёртку

## Связанные решения

- [001-arangodb-choice.md](001-arangodb-choice.md) - выбор ArangoDB
- [002-mcp-integration.md](002-mcp-integration.md) - интеграция через MCP

## Дополнительные материалы

- [Библиотека graph_viewer](../../src/lib/graph_viewer/README.md)
- [MCP-сервер](../../src/mcp_server/README.md)
- [История разработки](../../docs-preliminary/project-history/chat_2025-10-14_frrom_SQLite.md)
