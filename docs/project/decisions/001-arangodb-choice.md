# Решение 001: Выбор ArangoDB в качестве основной базы данных

**Дата:** 2025-01-27  
**Статус:** ✅ Принято  
**Участники:** Александр, Claude (Cursor AI)

## Проблема

Для проекта fedoc требуется база данных, которая:
1. Поддерживает JSON документы (проектная документация)
2. Поддерживает графовые структуры (DAG задач, граф проектов)
3. Позволяет выполнять сложные запросы
4. Является бесплатной и open-source
5. Легко развертывается через Docker

## Рассмотренные варианты

### 1. MongoDB

**Описание:** Популярная NoSQL база данных для работы с JSON документами

**Плюсы:**
- Широко распространена
- Большое сообщество
- Много инструментов

**Минусы:**
- ❌ Нет нативной поддержки графов
- ❌ Лицензия SSPL (ограничения для облачных сервисов)
- ❌ Для графов нужна отдельная БД (Neo4j)

### 2. PostgreSQL + расширения

**Описание:** Реляционная БД с поддержкой JSON и графов через расширения

**Плюсы:**
- Надежная и проверенная
- Поддержка JSON (jsonb)
- Расширение AGE для графов

**Минусы:**
- ⚠️ Графы через расширение, не нативно
- ⚠️ Сложнее работать с иерархическими структурами
- ⚠️ Два разных подхода (SQL + графы)

### 3. ArangoDB (ВЫБРАН)

**Описание:** Multi-Model база данных (документы + графы + key-value)

**Плюсы:**
- ✅ Нативная поддержка JSON документов
- ✅ Нативная поддержка графов (идеально для DAG)
- ✅ Единая база для всех типов данных
- ✅ Apache 2.0 - полностью open-source
- ✅ Community Edition бесплатно без ограничений
- ✅ Web UI для визуализации
- ✅ AQL - мощный язык запросов

**Минусы:**
- ⚠️ Менее распространена чем MongoDB
- ⚠️ Меньше сообщество

## Решение

Выбран **ArangoDB** по следующим причинам:

### Основные преимущества:

1. **Multi-Model архитектура** - один инструмент для всех задач
2. **Нативные графы** - критично для DAG-структур задач из FEMSQ
3. **Лицензия Apache 2.0** - полная свобода использования
4. **Легкая миграция** - JSON из FEMSQ переносится 1:1

### Архитектурные соображения:

**Граф проектов:**
```
Задача 0004 присутствует в 3 деревьях:
(Task:0004) -[IN_TREE]-> (Tree:01)  # Артефакты
(Task:0004) -[IN_TREE]-> (Tree:02)  # Функционал  
(Task:0004) -[IN_TREE]-> (Tree:0a)  # Модули
```

Это естественно выражается в ArangoDB, но требует сложных запросов в MongoDB или PostgreSQL.

## Реализация

```yaml
# docker-compose.prod.yml
arangodb:
  image: arangodb/arangodb:3.11
  ports:
    - "127.0.0.1:8529:8529"
  environment:
    ARANGO_ROOT_PASSWORD: ${ARANGO_PASSWORD}
```

```python
# Python клиент
from arango import ArangoClient
client = ArangoClient(hosts='http://localhost:8529')
db = client.db('fedoc', username='root', password='...')
```

## Последствия

### Положительные:

- ✅ Единая база для документов и графов
- ✅ Простая миграция данных из FEMSQ
- ✅ Мощные графовые запросы (AQL)
- ✅ Бесплатно навсегда (Apache 2.0)
- ✅ Web UI для отладки

### Отрицательные:

- ⚠️ Нужно изучить AQL
- ⚠️ Меньше готовых решений в интернете
- ⚠️ Меньше интеграций с инструментами

## Альтернативы на будущее

Если потребуется миграция:
- **Neo4j** - если нужны только графы (но платная Enterprise версия)
- **PostgreSQL + AGE** - если нужна реляционная модель
- **MongoDB + Neo4j** - если нужна максимальная экосистема (но 2 БД)

## Связанные решения

- [002-mcp-integration.md](002-mcp-integration.md) - интеграция через MCP
- [003-graph-viewer-arch.md](003-graph-viewer-arch.md) - визуализация графов

## Дополнительные материалы

- [ArangoDB Documentation](https://www.arangodb.com/docs/)
- [Концепция централизованной системы](../../docs-preliminary/concepts/centralized-documentation-system-concept.md)
- [История создания](../../docs-preliminary/project-history/chat-2025-01-27-28-inception.md)
