# Правила ведения проектной документации fedoc

**Версия:** 1.0.0  
**Дата создания:** 2025-10-14  
**Последнее обновление:** 2025-10-14  
**Автор:** Александр  

## Обзор

Данный документ описывает структуру, правила и порядок ведения проектной документации для **fedoc** - централизованной системы правил и проектной документации для группы проектов. Система предназначена для хранения и переиспользования "строительных блоков" документации между проектами.

**Специфика fedoc:**
- Инфраструктурный проект (не приложение)
- Основа: библиотеки и инструменты (MCP-сервер, graph viewer)
- Технологии: Python 3.10+, ArangoDB, MCP Protocol
- Цель: управление документацией группы проектов

## Связанные документы

- **[Справочник по системе ссылок](project-documentation-rules-reference.md)** - таблица форматов ссылок, примеры, правила формирования ID
- **[Система структурной нумерации](project-documentation-rules-structural-numbering.md)** - правила нумерации модулей, компонентов, классов

## Структура документации

### 1. **project/project-docs.json** - Проектная документация
**Назначение:** Центральный файл с описанием архитектуры, технологий, компонентов и конфигурации проекта.
**Содержание:** метаданные, архитектура, компоненты (mcp-server, graph-viewer, lib), цели, принципы, features.

### 2. **development/project-development.json** - Планирование разработки
**Назначение:** Файл планирования разработки в виде иерархической структуры задач с возможностью сворачивания ветвей.
**Структура:** tasks (список задач) + structure (деревья с DAG-связями).

### 3. **journal/project-journal.json** - Дневник разработки
**Назначение:** Дневник разработки с детальным описанием выполненных работ, изменений и состояний.
**Структура:** chats → logs → actions (иерархия журнала).

### 4. **decisions/** - Архитектурные решения (ADR)
**Назначение:** Документация важных технических и архитектурных решений.
**Формат:** Markdown файлы с нумерацией (001-xxx.md).

## Объекты разработки

### Компоненты проекта fedoc

1. **MCP Server** (`src/mcp_server/`)
   - Сервер Model Context Protocol для интеграции с Cursor AI
   - Обработчики команд (handlers)
   - Конфигурация

2. **Graph Viewer** (`src/lib/graph_viewer/`)
   - Библиотека визуализации графов ArangoDB
   - Web интерфейс
   - CLI инструменты

3. **Database** (ArangoDB)
   - Коллекции: projects, canonical_nodes, rules, templates
   - Граф: common_project_graph
   - Схемы данных

4. **Development Tools** (`dev/`)
   - Docker конфигурации (`dev/docker/`)
   - CLI утилиты (`dev/tools/`)

## Процесс добавления новых артефактов

### Обязательный чеклист при создании нового артефакта

#### При создании нового модуля, компонента или Python модуля:

1. **Создать файл или папку артефакта** в соответствующей директории

2. **Добавить в project-docs.json:**
   - Найти соответствующий раздел в `project.objects` или `project.components`
   - Добавить описание артефакта
   - Указать: `name`, `location`, `description`, `status`
   - Для зависимостей указать в соответствующем разделе

3. **Создать задачу в project-development.json:**
   - **Добавить задачу** в `tasks.items` с новым ID (сквозная нумерация)
   - Указать `completionCriteria` вместо оценки времени
   - Добавить ссылку на артефакт в формате: `module:path.to.module`
   - **Обновить** `tasks.nextTaskId`

4. **Создать пункт структуры:**
   - Добавить `task-item` в соответствующее дерево (`structure.trees`)
   - Указать `structureId` с номером дерева (например, 01.01.01)
   - Указать `taskId` - ссылку на задачу
   - Обновить `displayName` с эмодзи статуса

5. **Добавить запись в project-journal.json:**
   - Создать лог о начале работы
   - Указать ссылки через иерархические пути:
     - `projectDocsRefs`: `["module:mcp_server.handlers.graph_visualizer"]`
     - `developmentTasks`: `["task:0004"]`

6. **Обновить зависимости:**
   - Если артефакт используется в других местах - указать зависимости
   - Если задача нужна в нескольких деревьях - создать дополнительные пункты с тем же `taskId`

### Контроль целостности ссылок

При добавлении артефакта **ОБЯЗАТЕЛЬНО** проверить:
- ✅ Есть ли описание в `project-docs.json`
- ✅ Есть ли задача в `project-development.json` → `tasks.items`
- ✅ Есть ли пункт структуры в `structure.trees` со ссылкой на задачу
- ✅ Есть ли запись в журнале `project-journal.json`
- ✅ Корректны ли все ссылки в формате `type:path`:
  - `projectDocsRefs`: `module:path.to.module`, `collection:collectionName`
  - `journalRefs`: `chat:chatId`, `log:logId`
  - `developmentTasks`: `task:taskId`
  - `decisionRefs`: `adr:001`
- ✅ Указаны ли зависимости
- ✅ Синхронизированы ли статусы (задача и все её пункты имеют одинаковый статус в displayName)
- ✅ Обновлен ли `tasks.nextTaskId`
- ✅ Корректны ли структурные номера (начинаются с номера дерева)

## Связи между файлами

### Принципы связей

**Все связи выражаются через поле `links` с использованием иерархических путей:**

```json
{
  "links": {
    "projectDocsRefs": ["module:mcp_server.handlers", "collection:projects"],
    "journalRefs": ["chat:chat-2025-10-14-001", "log:log-2025-10-14-001"],
    "developmentTasks": ["task:0004", "task:0005"],
    "decisionRefs": ["adr:001", "adr:002"]
  }
}
```

**Формат ссылок:**
- `module:path.to.module` - Python модуль
- `component:componentName` - компонент системы
- `collection:collectionName` - коллекция ArangoDB
- `graph:graphName` - граф ArangoDB
- `task:taskId` - задача разработки
- `chat:chatId` или `log:logId` - запись журнала
- `adr:number` - архитектурное решение
- `tool:toolName` - инструмент разработки

### 1. **project-docs.json** → **project-development.json**

Задачи разработки ссылаются на компоненты проекта:

```json
// project-docs.json
{
  "mcp-server": {
    "name": "fedoc MCP Server",
    "location": "src/mcp_server",
    "commands": ["show_graph", "query_graph"]
  }
}

// project-development.json
{
  "tasks": {
    "items": {
      "0004": {
        "task": {
          "task-attributes": {
            "links": {
              "projectDocsRefs": [
                "component:mcp-server",
                "module:mcp_server.handlers.graph_visualizer"
              ]
            }
          }
        }
      }
    }
  }
}
```

### 2. **project-development.json** → **project-journal.json**

Задачи ссылаются на записи журнала:

```json
// project-development.json
{
  "tasks": {
    "items": {
      "0004": {
        "task": {
          "task-attributes": {
            "links": {
              "journalRefs": [
                "chat:chat-2025-10-14-001",
                "log:log-2025-10-14-001"
              ]
            }
          }
        }
      }
    }
  }
}

// project-journal.json
{
  "sessions": [
    {
      "chat": {
        "chat-attributes": {
          "id": "chat-2025-10-14-001"
        }
      }
    }
  ]
}
```

### 3. **project-journal.json** → **project-development.json**

Записи журнала ссылаются на задачи:

```json
// project-journal.json
{
  "chat": {
    "chat-attributes": {
      "id": "chat-2025-10-14-001",
      "links": {
        "developmentTasks": [
          "task:0004",
          "task:0005"
        ]
      }
    }
  }
}
```

### 4. **project-journal.json** → **project-docs.json**

Записи журнала ссылаются на компоненты и модули:

```json
// project-journal.json
{
  "log": {
    "log-attributes": {
      "id": "log-2025-10-14-001",
      "links": {
        "projectDocsRefs": [
          "component:graph-viewer",
          "module:lib.graph_viewer.viewer",
          "collection:canonical_nodes"
        ],
        "decisionRefs": [
          "adr:003"
        ]
      }
    }
  }
}
```

### Важно

**Внутренняя организация project-development.json** (деревья структуры с пунктами) - это НЕ связь между файлами, а механизм организации задач для навигации. При изменении статуса задачи он автоматически синхронизируется во всех пунктах структуры, где эта задача используется.

---

## Система ссылок через иерархические пути

### Формат ссылок

Все ссылки используют формат `type:path`, где путь строится из ID элементов через точку (для Python модулей) или простое имя (для компонентов).

### Таблица форматов для fedoc

| Тип | Формат | Пример |
|-----|--------|--------|
| Компонент | `component:name` | `component:mcp-server` |
| Python модуль | `module:path.to.module` | `module:mcp_server.handlers.graph_visualizer` |
| Коллекция БД | `collection:name` | `collection:projects` |
| Граф БД | `graph:name` | `graph:common_project_graph` |
| Задача | `task:id` | `task:0004` |
| Дерево | `tree:number` | `tree:01` |
| Пункт структуры | `item:tree.structure` | `item:01.01.01` |
| Чат | `chat:id` | `chat:chat-2025-10-14-001` |
| Лог | `log:id` | `log:log-2025-10-14-001` |
| ADR | `adr:number` | `adr:001` |
| Инструмент | `tool:name` | `tool:view-graph` |

### Правила формирования ID

**Для компонентов:**
- Использовать kebab-case
- Краткие, но понятные
- Примеры: `mcp-server`, `graph-viewer`, `database`

**Для Python модулей:**
- snake_case (как в Python)
- Полный путь от src/
- Примеры: `mcp_server.handlers.graph_visualizer`, `lib.graph_viewer.viewer`

**Для коллекций и графов:**
- snake_case (как в ArangoDB)
- Множественное число для коллекций
- Примеры: `projects`, `canonical_nodes`, `common_project_graph`

**Для инструментов:**
- kebab-case
- Краткое имя
- Примеры: `view-graph`, `db-manager`, `deploy-to-server`

### Преимущества

- ✅ **Устойчивость** - не зависит от порядка элементов в массивах
- ✅ **Уникальность** - путь через точку гарантирует уникальность
- ✅ **Читаемость** - понятна структура и местоположение
- ✅ **Соответствие коду** - похоже на пути Python модулей
- ✅ **Гибкость** - можно ссылаться на любой уровень иерархии

## Особенности инфраструктурных проектов

### Отличия от прикладных проектов

**fedoc как инфраструктура:**
- Основной продукт - библиотеки и инструменты, а не приложение
- Артефакты: Python модули, MCP-команды, CLI скрипты
- Пользователи: другие проекты и разработчики
- Документация: акцент на API и интеграции

**Специфика документирования:**
1. **Компоненты** вместо модулей приложения
2. **Инструменты** как объекты разработки
3. **ADR документы** для технических решений
4. **Интеграции** как ключевой аспект

### Примеры артефактов fedoc

**MCP-команды:**
```json
{
  "links": {
    "projectDocsRefs": [
      "component:mcp-server",
      "module:mcp_server.handlers.graph_visualizer"
    ]
  }
}
```

**Библиотеки:**
```json
{
  "links": {
    "projectDocsRefs": [
      "module:lib.graph_viewer.viewer",
      "module:lib.graph_viewer.web_viewer"
    ]
  }
}
```

**CLI инструменты:**
```json
{
  "links": {
    "projectDocsRefs": [
      "tool:view-graph",
      "component:graph-viewer"
    ]
  }
}
```

**Схемы данных:**
```json
{
  "links": {
    "projectDocsRefs": [
      "collection:projects",
      "graph:common_project_graph"
    ]
  }
}
```

## Правила обновления

### Обязательные требования
- **Перед любыми корректировками документации** - обязательно изучить и учесть правила ведения документации
- **Перед созданием записей в журнале** - обязательно запросить имя чата у пользователя с предложением вариантов
- **При изменении структуры** - обновить соответствующие правила и связанные файлы
- **При добавлении компонента** - создать ADR если решение значимое

### Формат дат
- **ISO 8601:** YYYY-MM-DDTHH:mm:ssZ
- **Пример:** 2025-10-14T10:30:00Z

## Структура файлов документации

### Организация папок
```
docs/
├── project-documentation-rules.md  # Правила ведения документации
├── project/                        # Документация проекта
│   ├── project-docs.json          # Основной файл проекта
│   └── decisions/                 # ADR решения (001-xxx.md)
├── development/                    # Документация разработки
│   └── project-development.json   # Файл задач разработки
└── journal/                       # Журнал разработки
    └── project-journal.json       # Файл журнала
```

### Принципы организации
- **Модульность** - каждый тип документации в своей папке
- **Самодостаточность** - каждая папка содержит все необходимые файлы
- **Навигация** - понятная структура для быстрого поиска
- **Расширяемость** - легко добавлять новые типы документации

## Инструменты и автоматизация

### Рекомендуемые инструменты
- **JSON Editor** - для редактирования JSON файлов
- **Git** - для версионирования изменений
- **Markdown Editor** - для ADR документации
- **Cursor AI** - для работы с документацией через MCP

### Автоматизация
- **Валидация JSON** - проверка корректности структуры (pydantic)
- **Синхронизация ссылок** - проверка целостности связей
- **Генерация отчетов** - автоматическое создание отчетов
- **Визуализация** - графы проектов через graph_viewer

## Контроль качества

### Проверки
- **Структурная целостность** - корректность JSON структуры
- **Ссылочная целостность** - существование всех ссылок
- **Временная согласованность** - логичность временных рамок
- **Зависимостная целостность** - корректность зависимостей

### Ревизии
- **Еженедельные** - проверка актуальности документации
- **Ежемесячные** - анализ полноты и качества
- **По требованию** - при значительных изменениях

## Резервное копирование

### Стратегия бэкапов
- **Ежедневные** - автоматические бэкапы в Git
- **Перед изменениями** - создание снимков состояния
- **Внешние** - копирование в GitHub

### Восстановление
- **Из Git** - восстановление из истории версий
- **Частичное** - восстановление отдельных разделов
- **Полное** - восстановление всей документации

## Заключение

Данная система документации обеспечивает:
- **Полноту** - охват всех аспектов инфраструктурного проекта
- **Структурированность** - четкая организация информации
- **Трассируемость** - возможность отслеживания изменений
- **Масштабируемость** - возможность расширения системы
- **Удобство использования** - простота навигации и поиска
- **Интеграцию с AI** - работа через Cursor AI с MCP
- **Переиспользование** - применение в группе проектов

Соблюдение данных правил гарантирует качество и актуальность проектной документации на всех этапах разработки системы fedoc и проектов, которые её используют.

---

**Документ утвержден:** 2025-10-14  
**Следующий пересмотр:** 2026-01-14  
**Ответственный:** Александр

