# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã mcp-fedoc

**–î–∞—Ç–∞:** 26 —è–Ω–≤–∞—Ä—è 2025  
**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å), Claude (–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç)  
**–¢–µ–º–∞:** –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ mcp-fedoc –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–æ–≤

## üéØ –¶–µ–ª–∏ —Å–µ—Å—Å–∏–∏

1. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã mcp-fedoc –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Graph Viewer
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
3. –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–º–∞–Ω–¥–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä—ë–±–µ—Ä –≤ PostgreSQL

## üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–û—à–∏–±–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**
- **–ü—Ä–æ–±–ª–µ–º–∞:** `TypeError: Private element is not present on this object` –≤ `vis-network.js`
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `network.value.getSelectedNodes()` –∏ `network.value.getSelectedEdges()`
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sendSelectionToServer` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Pinia store

### 2. **–û—à–∏–±–∫–∞ "_id" –≤ –∫–æ–º–∞–Ω–¥–µ add_edge**
- **–ü—Ä–æ–±–ª–µ–º–∞:** `–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: '_id'` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—ë–±–µ—Ä
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `agtype` –∑–Ω–∞—á–µ–Ω–∏–π –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `edge_id` –∏–∑ API –æ—Ç–≤–µ—Ç–æ–≤
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `agtype_to_python` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ `edge_manager.py` –∏ `server.py`

### 3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –†—ë–±—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `c:backend-framework` ‚Üí `v:java@21` –≤–º–µ—Å—Ç–æ `v:java@21` ‚Üí `c:backend-framework`)
- **–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL —Ñ—É–Ω–∫—Ü–∏—è `get_all_graph_for_viewer` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π Cypher –∑–∞–ø—Ä–æ—Å `(n)-[e]-(m)`
- **–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω—ë–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `(n)-[e]->(m)` –∏ —É–±—Ä–∞–Ω—ã –≤—Å–µ –∫–æ—Å—Ç—ã–ª–∏ –∏–∑ API

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Frontend (Graph Viewer)
```javascript
// src/lib/graph_viewer/frontend/src/stores/graph.js
const sendSelectionToServer = () => {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ store –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ vis-network
  const selectedNodes = (selectedNodesList.value || []).map(n => 
    (n && typeof n === 'object' ? (n.id ?? n) : n)
  )
  const selectedEdges = (selectedEdgesList.value || []).map(e => 
    (e && typeof e === 'object' ? (e.id ?? e) : e)
  )
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### Backend (API Server)
```python
# src/lib/graph_viewer/backend/api_server_age.py
def agtype_to_python(agtype_value):
    # –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ agtype –∑–Ω–∞—á–µ–Ω–∏–π
    if isinstance(parsed, dict) and '_id' in parsed:
        return parsed['_id']
    return parsed
```

### PostgreSQL —Ñ—É–Ω–∫—Ü–∏—è
```sql
-- dev/docker/init-scripts/postgres/06-graph-viewer-functions.sql
MATCH (n:canonical_node)-[e:project_relation]->(m:canonical_node)
-- –ò–∑–º–µ–Ω–µ–Ω–æ —Å (n)-[e]-(m) –Ω–∞ (n)-[e]->(m) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `mcp_fedoc_graph_viewer_status` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç
- `mcp_fedoc_check_imports` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç  
- `mcp_fedoc_check_stubs` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç
- `mcp_fedoc_get_selected_nodes` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- `mcp_fedoc_add_edge` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `mcp_fedoc_delete_edge` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç
- `mcp_fedoc_check_edge_uniqueness` - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç

### üéØ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏
–í —Ö–æ–¥–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–≤—è–∑–∏:
1. `t:spring-boot` ‚Üí `c:backend-api` (uses)
2. `t:spring-boot` ‚Üí `c:backend-reactive` (uses)  
3. `t:spring-boot` ‚Üí `c:backend-migrations` (uses)
4. `t:spring-boot` ‚Üí `c:backend-security` (uses)
5. `t:spring-boot` ‚Üí `c:backend-cache` (uses)
6. `t:spring-boot` ‚Üí `c:backend-monitoring` (uses)

## üßπ –û—á–∏—Å—Ç–∫–∞

### –£–¥–∞–ª—ë–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `update_graph_function.sql` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π SQL —Å–∫—Ä–∏–ø—Ç
- `fix_direction.sql` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π SQL —Å–∫—Ä–∏–ø—Ç
- `/tmp/all_nodes.txt` –∏ `/tmp/connected_nodes.txt` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–Ω–∞–ª–∏–∑–∞

### –£–¥–∞–ª—ë–Ω–Ω—ã–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- Endpoint `/api/debug/raw-graph` - –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π endpoint
- Endpoint `/api/fix-direction` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π endpoint –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –í—Å–µ –∫–æ—Å—Ç—ã–ª–∏ –≤ API –∫–æ–¥–µ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä—ë–±–µ—Ä

## üéâ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**‚úÖ –°–∏—Å—Ç–µ–º–∞ mcp-fedoc –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!**

- **–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –±–µ–∑ –∫–æ—Å—Ç—ã–ª–µ–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL —Ñ—É–Ω–∫—Ü–∏–∏
- **WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±—Ä–∞—É–∑–µ—Ä–æ–º
- **–°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä** —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
1. **PostgreSQL** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_all_graph_for_viewer` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. **API Server** - —É–±—Ä–∞–Ω—ã –∫–æ—Å—Ç—ã–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î
3. **Frontend** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
4. **MCP Server** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–º–∞–Ω–¥–∞—Ö

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/graph_viewer/frontend/src/stores/graph.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sendSelectionToServer`
- `src/lib/graph_viewer/backend/api_server_age.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `agtype_to_python`
- `src/mcp_server/handlers/edge_manager.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `edge_id`
- `dev/docker/init-scripts/postgres/06-graph-viewer-functions.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω Cypher –∑–∞–ø—Ä–æ—Å

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
