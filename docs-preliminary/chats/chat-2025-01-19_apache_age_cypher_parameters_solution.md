# –ß–∞—Ç: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ Apache AGE Cypher

**–î–∞—Ç–∞:** 19 —è–Ω–≤–∞—Ä—è 2025  
**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä, Claude  
**–¢–µ–º–∞:** –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ—à–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Apache AGE —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º Cypher

## üéØ –¶–µ–ª—å —á–∞—Ç–∞

–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ Apache AGE 1.6.0 –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–µ –ø—É—Ç–µ–π Cypher –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–Ω–∏–∫–ª–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å ArangoDB –Ω–∞ PostgreSQL + Apache AGE.

## üîç –ü—Ä–æ–±–ª–µ–º–∞

### –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- **Graph Viewer** —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å ArangoDB –Ω–∞ PostgreSQL + Apache AGE
- **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞, –≤—ã–±–æ—Ä —É–∑–ª–æ–≤/—Ä—ë–±–µ—Ä)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Apache AGE —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º Cypher –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–µ –ø—É—Ç–µ–π

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
1. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–µ** - `*1..$max_depth` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
2. **PREPARE/EXECUTE –ø–æ–¥—Ö–æ–¥** - –æ—à–∏–±–∫–∞ `build_vle_match_edge(): properties argument must be an object`
3. **–ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** - –æ—à–∏–±–∫–∞ `third argument of cypher function must be a parameter`

## üß™ –ü—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö Cypher –∑–∞–ø—Ä–æ—Å–æ–≤
```sql
-- ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
MATCH (n)-[r*1..3]-(m) RETURN n, r, m
MATCH (n)-[r*1..5]-(m) RETURN n, r, m
MATCH (n)-[r*1..10]-(m) RETURN n, r, m
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```sql
-- ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
MATCH (n)-[r*1..$max_depth]-(m) RETURN n, r, m
-- –û—à–∏–±–∫–∞: third argument of cypher function must be a parameter
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PREPARE/EXECUTE
```sql
-- ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
PREPARE find_relatives(agtype) AS ...
EXECUTE find_relatives('{"max_depth": 3}');
-- –û—à–∏–±–∫–∞: build_vle_match_edge(): properties argument must be an object
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PL/pgSQL —Ñ—É–Ω–∫—Ü–∏–π
```sql
-- ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
CREATE OR REPLACE FUNCTION find_relatives_func(max_depth INTEGER) ...
-- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
```

## üí° –ù–∞–π–¥–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏—è `_aa3` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–°–æ–∑–¥–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:**
```sql
CREATE OR REPLACE FUNCTION _aa3 (max_depth int)
RETURNS TABLE(n agtype, r agtype, m agtype)
AS $a$
DECLARE
    s1 text;
    s2 text;
    s3 text;
    s4 text;
    s5 text;
    s6 text;
    s7 text;
    query_string TEXT;
BEGIN
    s1 := 'SELECT * FROM cypher (';
    s2 := '''common_project_graph'', ';
    s3 := '$$ ';
    s4 := 'MATCH (n)-[r*1..';
    s5 := ']-(m) RETURN n, r, m LIMIT 5 ';
    s6 := '$$ ';
    s7 := ') as (n agtype, r agtype, m agtype);';

    query_string := s1 || s2 || s3 || s4 || max_depth || s5 || s6 || s7;
    RETURN QUERY EXECUTE query_string;
END;
$a$ LANGUAGE plpgsql;
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```sql
-- ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
SELECT * FROM _aa3(1);   -- –ì–ª—É–±–∏–Ω–∞ 1
SELECT * FROM _aa3(3);    -- –ì–ª—É–±–∏–Ω–∞ 3  
SELECT * FROM _aa3(5);    -- –ì–ª—É–±–∏–Ω–∞ 5
SELECT * FROM _aa3(10);   -- –ì–ª—É–±–∏–Ω–∞ 10
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

**–§—É–Ω–∫—Ü–∏—è `_aa3` —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ Apache AGE**, –∏—Å–ø–æ–ª—å–∑—É—è:

1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø—Ä–æ—Å–∞** —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –≥–ª—É–±–∏–Ω—ã
2. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `EXECUTE`** - –æ–±—Ö–æ–¥–∏—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Apache AGE
3. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
- –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `max_depth int`
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É Cypher –∑–∞–ø—Ä–æ—Å–∞ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `EXECUTE`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ agtype

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è Graph Viewer

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å–µ—Ä–≤–µ—Ä–∞:
```python
# –í–º–µ—Å—Ç–æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:
# MATCH path = (start)-[e:project_relation*1..{depth}]->(target)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é:
def get_subgraph_with_depth(node_id, max_depth):
    query = f"SELECT * FROM _aa3({max_depth})"
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å...
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
- **"–°–∫—Ä—ã—Ç—å —É–∑–µ–ª —Å –≤—ã—à–µ—Å—Ç–æ—è—â–∏–º–∏"** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω—É–∂–Ω–æ–π –≥–ª—É–±–∏–Ω–æ–π
- **"–°–∫—Ä—ã—Ç—å —É–∑–µ–ª —Å –Ω–∏–∂–µ—Å—Ç–æ—è—â–∏–º–∏"** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã** - —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–µ—Ä—Å–∏–∏:
- **PostgreSQL:** 16.10
- **Apache AGE:** 1.6.0
- **Docker:** apache/age:latest

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Apache AGE 1.6.0:
- ‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–µ –ø—É—Ç–µ–π (`*1..$max_depth`)
- ‚ùå –ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ cypher()
- ‚ùå PREPARE/EXECUTE —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã (`*1..3`, `*1..5`)
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ PL/pgSQL

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_aa3`** –≤ API —Å–µ—Ä–≤–µ—Ä Graph Viewer
2. **–û–±–Ω–æ–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** —Å–∫—Ä—ã—Ç–∏—è —É–∑–ª–æ–≤ —Å —Ä–µ–∫—É—Ä—Å–∏–µ–π
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ Graph Viewer

## üìù –í—ã–≤–æ–¥—ã

**–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º Cypher –≤ Apache AGE 1.6.0 —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω—ã!** 

–§—É–Ω–∫—Ü–∏—è `_aa3` –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—á–∏–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–µ –ø—É—Ç–µ–π. –≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Graph Viewer –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Apache AGE.

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ:** –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Apache AGE —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ PL/pgSQL —Ñ—É–Ω–∫—Ü–∏—è—Ö.
