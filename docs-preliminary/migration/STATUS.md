# –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏ fedoc –Ω–∞ PostgreSQL + Apache AGE

**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞:** feature/migrate-to-postgresql-age  
**–ö–æ–º–º–∏—Ç:** d4f0003

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π ‚úÖ
- PostgreSQL 16.10 –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 176.108.244.252
- Apache AGE 1.6.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å cypher()

### 2. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚úÖ
–°–æ–∑–¥–∞–Ω—ã SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
- `01-init-age.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î fedoc
- `02-setup-age-extension.sql` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è AGE
- `03-create-graph.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ common_project_graph
- `04-validation-functions.sql` - **—Ñ—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∫–ª—é—á–µ–≤–∞—è —Ñ–∏—á–∞!)**
- `05-create-schema.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–∫ –≤–µ—Ä—à–∏–Ω –∏ —Ä—ë–±–µ—Ä

### 3. –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ PostgreSQL ‚úÖ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ (–≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ –ë–î!):
- `check_edge_uniqueness()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ –≤ –æ–±–æ–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
- `create_edge_safe()` - –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `update_edge_safe()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `delete_edge_safe()` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** 1 –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ 2 –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ + —Å–æ–∑–¥–∞–Ω–∏–µ)

### 4. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- `scripts/migrate-arango-to-age.py` - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—à–∏–Ω canonical_nodes ‚Üí canonical_node
- –ú–∏–≥—Ä–∞—Ü–∏—è —Ä—ë–±–µ—Ä project_relations ‚Üí project_relation
- –ú–∞–ø–ø–∏–Ω–≥ ID: ArangoDB ‚Üí AGE (—Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ JSON)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ ‚úÖ
- `MIGRATION-SUMMARY.md` - –æ–±–∑–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏
- `MIGRATION-GUIDE.md` - –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `AQL-TO-CYPHER-MAPPING.md` - –º–∞–ø–ø–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `README.md` –≤ init-scripts/postgres

---

## ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### 6. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ AQL ‚Üí Cypher ‚è≥
**–°—Ç–∞—Ç—É—Å:** –ú–∞–ø–ø–∏–Ω–≥ —Å–æ–∑–¥–∞–Ω, –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–î–æ–∫—É–º–µ–Ω—Ç `AQL-TO-CYPHER-MAPPING.md` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- ‚úÖ –í—Å–µ 7 —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ api_server.py
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—é

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–±–Ω–æ–≤–∏—Ç—å `src/lib/graph_viewer/backend/api_server.py`

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API endpoints ‚è≥
**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ

–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
- `api_server.py` - –∑–∞–º–µ–Ω–∏—Ç—å python-arango –Ω–∞ psycopg2
- `edge_validator.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ PostgreSQL
- `config.py` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL

### 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚è≥
**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ

–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- [ ] –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î (–∑–∞–ø—É—Å–∫ init-scripts)
- [ ] –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –¢–µ—Å—Ç Cypher –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

**–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** 5/8 –∑–∞–¥–∞—á (62.5%)

```
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π
‚úÖ –°—Ö–µ–º–∞ –ë–î + —Ñ—É–Ω–∫—Ü–∏–∏
‚úÖ –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤
‚è≥ –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∫–æ–¥–∞ API
‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚è≥ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å init-scripts –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL
   ssh vuege-server
   cd ~/fedoc/dev/docker
   ./db-manager.sh stop-postgres
   docker rm fedoc-postgres
   rm -rf postgres-data/*
   git pull origin feature/migrate-to-postgresql-age
   ./db-manager.sh start-postgres
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
   docker exec fedoc-postgres psql -U postgres -d fedoc -c "\df"
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö (—Ç–µ—Å—Ç–æ–≤–æ):**
   ```bash
   # –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
   pip install -r scripts/migration-requirements.txt
   # –°–æ–∑–¥–∞—Ç—å SSH —Ç—É–Ω–Ω–µ–ª–∏
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å migrate-arango-to-age.py
   ```

3. **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å api_server.py:**
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `api_server_age.py`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
   - –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ endpoints —Å Cypher

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:

4. **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ArangoDB vs PostgreSQL+AGE
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã

5. **–û–±–Ω–æ–≤–∏—Ç—å Graph Viewer frontend:**
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –Ω–æ–≤—ã–º ID (bigint –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫)
   - –û–±–Ω–æ–≤–∏—Ç—å WebSocket handlers

6. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ production:**
   - –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø ArangoDB
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## üìù –ó–∞–º–µ—Ç–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ arango_key –∫–∞–∫ —Å–≤–æ–π—Å—Ç–≤–∞**
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
   - –£–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ ArangoDB

2. **–§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ PostgreSQL**
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤ –ë–î
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

3. **–ú–∞–ø–ø–∏–Ω–≥ ID –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏**
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
   - –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Cypher –≤ AGE**
   - –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –í–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

2. **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö agtype**
   - –¢—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤
   - –£—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥ Python

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
   - AGE –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `$params$` –±–ª–æ–∫
   - –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ SQL

---

**–ê–≤—Ç–æ—Ä:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 18 –æ–∫—Ç—è–±—Ä—è 2025, 20:00

