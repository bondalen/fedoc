# üéâ –£—Å–ø–µ—à–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö fedoc –≤ PostgreSQL + Apache AGE

**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025, 21:30 UTC  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–µ—Ä—à–∏–Ω—ã (Vertices)
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** ArangoDB –∫–æ–ª–ª–µ–∫—Ü–∏—è `canonical_nodes`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** AGE –º–µ—Ç–∫–∞ `canonical_node` –≤ –≥—Ä–∞—Ñ–µ `common_project_graph`
- **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:** **39 –≤–µ—Ä—à–∏–Ω** ‚úÖ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `MATCH (n) RETURN count(n)` ‚Üí 39 ‚úÖ

### –†—ë–±—Ä–∞ (Edges)
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** ArangoDB –∫–æ–ª–ª–µ–∫—Ü–∏—è `project_relations`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** AGE –º–µ—Ç–∫–∞ `project_relation` –≤ –≥—Ä–∞—Ñ–µ `common_project_graph`
- **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:** **34 —Ä–µ–±—Ä–∞** ‚úÖ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `MATCH ()-[e]->() RETURN count(e)` ‚Üí 34 ‚úÖ

### –ú–∞–ø–ø–∏–Ω–≥ ID
- **–§–∞–π–ª:** `migration-id-mapping.json`
- **–ó–∞–ø–∏—Å–µ–π:** 39
- **–§–æ—Ä–º–∞—Ç:** `"canonical_nodes/c:backend" ‚Üí 844424930132013`

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä—ã –≤–µ—Ä—à–∏–Ω

```sql
MATCH (n:canonical_node) RETURN n.arango_key, n.name LIMIT 5
```

| arango_key | name |
|------------|------|
| c:project | –ü—Ä–æ–µ–∫—Ç |
| c:dev-objects | –û–±—ä–µ–∫—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| c:layer | –°–ª–æ–π |
| c:backend | –ë—ç–∫–µ–Ω–¥ |
| c:project-database | –ë–î –ø—Ä–æ–µ–∫—Ç–∞ |

‚úÖ –í—Å–µ –∏–º–µ–Ω–∞ –∏ –∫–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### –ü—Ä–∏–º–µ—Ä—ã —Ä—ë–±–µ—Ä

```sql
MATCH (a)-[e]->(b) 
RETURN a.arango_key, e.projects, e.relationType, b.arango_key 
LIMIT 5
```

| from | projects | type | to |
|------|----------|------|----|
| c:project | [fepro, femsq, fedoc] | - | c:dev-objects |
| c:dev-objects | [fepro, femsq] | - | c:layer |
| c:layer | [fepro, femsq] | - | c:backend |
| c:dev-objects | [fedoc] | - | c:project-database |
| c:backend | [fepro, femsq] | - | c:backend-database |

‚úÖ –í—Å–µ —Å–≤—è–∑–∏, –ø—Ä–æ–µ–∫—Ç—ã –∏ —Ç–∏–ø—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### –û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞

```sql
MATCH (a {arango_key: 'c:backend'})-[e*1..2]->(b) 
RETURN a.name, b.name
```

–ü—É—Ç–∏ –æ—Ç "–ë—ç–∫–µ–Ω–¥":
- ‚Üí –ë–î –±—ç–∫–µ–Ω–¥–∞ ‚Üí PostgreSQL
- ‚Üí –ë–î –±—ç–∫–µ–Ω–¥–∞ ‚Üí MS SQL Server  
- ‚Üí –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ ‚Üí Java
- ‚Üí –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ ‚Üí Python

‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–º–µ—Ä —Ä–µ–±—Ä–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:**
```json
{
  "source": "project-documentation",
  "weight": 2,
  "metadata": {"created": "2025-10-13T14:01:42.436622Z"},
  "projects": ["fepro", "femsq"],
  "description": "–ë—ç–∫–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö",
  "relationType": "uses"
}
```

‚úÖ –í—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–§—É–Ω–∫—Ü–∏—è:** `dict_to_cypher_map()`

**–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:**
- `str` ‚Üí `'string'` (–æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏)
- `int/float` ‚Üí `42` (–±–µ–∑ –∫–∞–≤—ã—á–µ–∫)
- `bool` ‚Üí `true/false` (–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä)
- `list` ‚Üí `['item1', 'item2']`
- `dict` ‚Üí `{key: 'value'}` (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
- `None` ‚Üí `null`

**–ü—Ä–∏–º–µ—Ä:**
```python
# Python dict
{"name": "Backend", "count": 42, "active": True, "tags": ["api", "rest"]}

# Cypher map
{name: 'Backend', count: 42, active: true, tags: ['api', 'rest']}
```

### –ú–∞–ø–ø–∏–Ω–≥ ID

**–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ `migration-id-mapping.json`:**
```json
{
  "canonical_nodes/c:project": 844424930132010,
  "canonical_nodes/c:backend": 844424930132013,
  "canonical_nodes/t:postgresql@16": 844424930132016,
  ...
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API
- –û—Ç–ª–∞–¥–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python3 scripts/migrate-arango-to-age.py \
  --arango-host http://localhost:8529 \
  --arango-password "fedoc_test_2025" \
  --pg-host localhost \
  --pg-port 5432 \
  --pg-password "fedoc_test_2025" \
  --no-validation \
  --export-mapping ./migration-id-mapping.json
```

**–í–∞–∂–Ω–æ:** `--no-validation` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ PostgreSQL - —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∏. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ Python –∫–æ–¥–µ (`edge_validator_age.py`).

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ ArangoDB vs PostgreSQL+AGE

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

| –ê—Å–ø–µ–∫—Ç | ArangoDB | PostgreSQL+AGE |
|--------|----------|----------------|
| –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤–µ—Ä—à–∏–Ω | `canonical_nodes` | –ì—Ä–∞—Ñ + –º–µ—Ç–∫–∞ `canonical_node` |
| –ö–æ–ª–ª–µ–∫—Ü–∏—è —Ä—ë–±–µ—Ä | `project_relations` | –ì—Ä–∞—Ñ + –º–µ—Ç–∫–∞ `project_relation` |
| ID –≤–µ—Ä—à–∏–Ω | `"canonical_nodes/12345"` | `844424930132013` (bigint) |
| ID —Ä—ë–±–µ—Ä | `"project_relations/67890"` | `1125899906842629` (bigint) |
| –°–≤–æ–π—Å—Ç–≤–∞ | JSON –Ω–∞–ø—Ä—è–º—É—é | `agtype` (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π JSON) |

### –ó–∞–ø—Ä–æ—Å—ã

| –û–ø–µ—Ä–∞—Ü–∏—è | ArangoDB (AQL) | PostgreSQL+AGE (Cypher) |
|----------|----------------|-------------------------|
| –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—à–∏–Ω—É | `FOR d IN canonical_nodes` | `MATCH (n:canonical_node)` |
| –û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞ | `FOR v,e IN 1..5 OUTBOUND` | `MATCH ()-[e*1..5]->()` |
| –§–∏–ª—å—Ç—Ä –ø–æ —Å–≤–æ–π—Å—Ç–≤—É | `FILTER 'fepro' IN e.projects` | `WHERE 'fepro' = ANY(e.projects)` |
| –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—à–∏–Ω—É | `INSERT {...}` | `CREATE (n {...})` |
| –°–æ–∑–¥–∞—Ç—å —Ä–µ–±—Ä–æ | `INSERT {...}` | `CREATE (a)-[e {...}]->(b)` |

---

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. ‚úÖ **100% –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ**
   - –í—Å–µ 39 –≤–µ—Ä—à–∏–Ω
   - –í—Å–µ 34 —Ä–µ–±—Ä–∞
   - –í—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

2. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**
   - –í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
   - –í—Å–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
   - –í—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—è

3. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω `arango_key` –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö
   - –ú–∞–ø–ø–∏–Ω–≥ ID —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞

4. ‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö**
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
   - –ú–∞—Å—Å–∏–≤—ã (projects) —Ä–∞–±–æ—Ç–∞—é—Ç
   - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. ‚úÖ **–î–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã** - –í–´–ü–û–õ–ù–ï–ù–û
2. ‚è≥ **–ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
3. ‚è≥ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å frontend** - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. ‚è≥ **Production deployment** - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ AGE

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–∞
   - –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Cypher –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
   - –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤ PostgreSQL
   - –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ Python –∫–æ–¥–µ

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - Alerts –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh vuege-server
docker exec fedoc-postgres psql -U postgres -d fedoc

# –í psql:
LOAD 'age';
SET search_path = ag_catalog, public;

-- –ü–æ–¥—Å—á—ë—Ç
SELECT * FROM cypher('common_project_graph', $$
    MATCH (n) RETURN count(n)
$$) as (cnt agtype);

-- –ü—Ä–∏–º–µ—Ä—ã
SELECT * FROM cypher('common_project_graph', $$
    MATCH (a)-[e]->(b)
    RETURN a.name, e.projects, b.name
    LIMIT 10
$$) as (from_name agtype, projects agtype, to_name agtype);

-- –û–±—Ö–æ–¥ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞
SELECT * FROM cypher('common_project_graph', $$
    MATCH (start {arango_key: 'c:backend'})-[e*1..3]->(end)
    RETURN end.name
$$) as (name agtype);
```

### –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å –∫ PostgreSQL)
ssh -L 5432:localhost:5432 vuege-server -N &

cd src/lib/graph_viewer/backend
python3 api_server_age.py \
    --db-host localhost \
    --db-port 5432 \
    --db-password "fedoc_test_2025" \
    --port 8899
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
python3 scripts/test-age-api.py
```

---

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –î–ê–ù–ù–´–• –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!

**–í—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏:** ~2 –º–∏–Ω—É—Ç—ã  
**–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100%  
**–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö:** 0%

---

**–ê–≤—Ç–æ—Ä:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä + Claude  
**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç:** 3ed5336

