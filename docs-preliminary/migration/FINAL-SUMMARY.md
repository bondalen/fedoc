# üéâ –ú–∏–≥—Ä–∞—Ü–∏—è fedoc –Ω–∞ PostgreSQL + Apache AGE - –ó–ê–í–ï–†–®–ï–ù–ê!

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞:** `feature/migrate-to-postgresql-age`  
**–ö–æ–º–º–∏—Ç–æ–≤:** 18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–ï 8 –ó–ê–î–ê–ß –í–´–ü–û–õ–ù–ï–ù–´** (100%)

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≤–µ—Ç–∫–∞ feature/migrate-to-postgresql-age
- –ö–æ–º–º–∏—Ç: `679fa80` ‚Üí `319be4e`
- 18 –∫–æ–º–º–∏—Ç–æ–≤ —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### 2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤–µ—Ä—Å–∏–∏ PostgreSQL –∏ Apache AGE
- **PostgreSQL:** 16.10 (Alpine) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 176.108.244.252
- **Apache AGE:** 1.6.0 (PG16/v1.6.0-rc0)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** fedoc-postgres (—Å–æ–±—Ä–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ)

### 3. ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ö–µ–º–∞ –≥—Ä–∞—Ñ–∞ –≤ Apache AGE
```sql
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: fedoc
–ì—Ä–∞—Ñ: common_project_graph
–í–µ—Ä—à–∏–Ω—ã: canonical_node (–º–µ—Ç–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
–†—ë–±—Ä–∞: project_relation
```

### 4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ PostgreSQL
**–§–∞–π–ª—ã:**
- `04-validation-functions.sql` - —Ñ—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏
- `edge_validator_age.py` - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Python

**–§—É–Ω–∫—Ü–∏–∏:**
- `check_edge_uniqueness()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ –≤ –æ–±–æ–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
- `create_edge_safe()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `update_edge_safe()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `delete_edge_safe()` - —É–¥–∞–ª–µ–Ω–∏–µ

### 5. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª—ã:**
- `scripts/migrate-arango-to-age.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- `scripts/migration-requirements.txt` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `scripts/test-age-api.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

**–§—É–Ω–∫—Ü–∏–∏:**
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ ArangoDB
- –ú–∏–≥—Ä–∞—Ü–∏—è –≤–µ—Ä—à–∏–Ω —Å –º–∞–ø–ø–∏–Ω–≥–æ–º ID
- –ú–∏–≥—Ä–∞—Ü–∏—è —Ä—ë–±–µ—Ä —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 6. ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã AQL ‚Üí Cypher
**–î–æ–∫—É–º–µ–Ω—Ç:** `AQL-TO-CYPHER-MAPPING.md`

**–ü–æ–∫—Ä—ã—Ç–æ 7 —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —É–∑–ª–æ–≤ (—Å/–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É)
2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ (OUTBOUND –æ–±—Ö–æ–¥)
3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É–∑–ª–∞ (expand_node)
4. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–≥—Ä–∞—Ñ–∞ (subgraph)
5. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
6. –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–±—Ä–∞
7. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä

### 7. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã API endpoints
**–§–∞–π–ª—ã:**
- `src/lib/graph_viewer/backend/api_server_age.py` - –Ω–æ–≤—ã–π API —Å–µ—Ä–≤–µ—Ä (682 —Å—Ç—Ä–æ–∫–∏)
- `src/lib/graph_viewer/backend/edge_validator_age.py` - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è AGE (292 —Å—Ç—Ä–æ–∫–∏)
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω psycopg2-binary

**Endpoints (9 —à—Ç):**
- `GET /api/nodes` ‚úÖ
- `GET /api/graph` ‚úÖ
- `GET /api/object_details` ‚úÖ
- `GET /api/expand_node` ‚úÖ
- `GET /api/subgraph` ‚úÖ
- `POST /api/edges` ‚úÖ
- `PUT /api/edges/<id>` ‚úÖ
- `DELETE /api/edges/<id>` ‚úÖ
- `POST /api/edges/check` ‚úÖ
- WebSocket support ‚úÖ

### 8. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è
**–¢–µ—Å—Ç—ã:**
- ‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–î fedoc —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ AGE 1.6.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ –ì—Ä–∞—Ñ common_project_graph —Å–æ–∑–¥–∞–Ω
- ‚úÖ CREATE –≤–µ—Ä—à–∏–Ω—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ MATCH –≤–µ—Ä—à–∏–Ω—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ CREATE —Ä–µ–±—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**
```sql
-- –°–æ–∑–¥–∞–Ω–æ 2 –≤–µ—Ä—à–∏–Ω—ã –∏ 1 —Ä–µ–±—Ä–æ
Backend --[uses with projects: fepro, femsq]--> Java
```

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (5 —Ñ–∞–π–ª–æ–≤)
```
dev/docker/init-scripts/postgres/
‚îú‚îÄ‚îÄ 01-init-age.sql                 # –°–æ–∑–¥–∞–Ω–∏–µ –ë–î fedoc
‚îú‚îÄ‚îÄ 02-setup-age-extension.sql      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ AGE 1.6.0
‚îú‚îÄ‚îÄ 03-create-graph.sql             # –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞
‚îú‚îÄ‚îÄ 04-validation-functions.sql     # –§—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏
‚îú‚îÄ‚îÄ 05-create-schema.sql            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ö–µ–º–µ
‚îî‚îÄ‚îÄ README.md                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### Docker –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (3 —Ñ–∞–π–ª–∞)
```
dev/docker/
‚îú‚îÄ‚îÄ Dockerfile.postgres-age         # –û–±—Ä–∞–∑ PostgreSQL + AGE
‚îú‚îÄ‚îÄ docker-compose.prod.yml         # –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è AGE
‚îú‚îÄ‚îÄ .dockerignore                   # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
‚îî‚îÄ‚îÄ BUILD-POSTGRES-AGE.md           # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
```

### Python –∫–æ–¥ (3 —Ñ–∞–π–ª–∞)
```
src/lib/graph_viewer/backend/
‚îú‚îÄ‚îÄ api_server_age.py               # 682 —Å—Ç—Ä–æ–∫–∏ - –Ω–æ–≤—ã–π API
‚îú‚îÄ‚îÄ edge_validator_age.py           # 292 —Å—Ç—Ä–æ–∫–∏ - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä
‚îî‚îÄ‚îÄ (api_server.py)                 # –°—Ç–∞—Ä—ã–π (ArangoDB)
```

### –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (3 —Ñ–∞–π–ª–∞)
```
scripts/
‚îú‚îÄ‚îÄ migrate-arango-to-age.py        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ migration-requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ test-age-api.py                 # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (6 —Ñ–∞–π–ª–æ–≤)
```
docs-preliminary/migration/
‚îú‚îÄ‚îÄ MIGRATION-SUMMARY.md            # –û–±–∑–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ MIGRATION-GUIDE.md              # –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ AQL-TO-CYPHER-MAPPING.md        # –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ STATUS.md                       # –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ SUCCESS-REPORT.md               # –û—Ç—á–µ—Ç –æ–± —É—Å–ø–µ—Ö–µ
‚îî‚îÄ‚îÄ FINAL-SUMMARY.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

**–ò—Ç–æ–≥–æ:** 20+ –Ω–æ–≤—ã—Ö/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, ~4000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ö–æ–º–º–∏—Ç–æ–≤:** 18  
**–í–µ—Ç–æ–∫:** 1 (feature/migrate-to-postgresql-age)  
**–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 20  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3000  
**–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~1000  
**–¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** ~157,000 / 1,000,000 (15.7%)  
**–í—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã:** ~4 —á–∞—Å–∞  

---

## üöÄ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Docker –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
```bash
# –û–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω
docker images | grep fedoc/postgres-age
# fedoc/postgres-age:16-1.6.0

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
docker ps | grep fedoc-postgres
# Up 10 minutes (healthy)
```

### PostgreSQL + AGE ‚úÖ
```sql
-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
\l fedoc                           # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç

-- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ
SELECT extname, extversion 
FROM pg_extension 
WHERE extname = 'age';             # ‚úÖ age 1.6.0

-- –ì—Ä–∞—Ñ
SELECT * FROM ag_graph;            # ‚úÖ common_project_graph
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –≥—Ä–∞—Ñ–æ–º ‚úÖ
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—à–∏–Ω—ã
CREATE (n:canonical_node {name: 'Backend'})   # ‚úÖ

-- –ß—Ç–µ–Ω–∏–µ –≤–µ—Ä—à–∏–Ω—ã  
MATCH (n:canonical_node) RETURN n              # ‚úÖ

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–±—Ä–∞
CREATE (a)-[r:uses {projects: [...]}]->(b)    # ‚úÖ

-- –û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞
MATCH (a)-[r]->(b) RETURN a, r, b              # ‚úÖ
```

### Python API ‚úÖ
- `edge_validator_age.py` - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä —Ä—ë–±–µ—Ä ‚úÖ
- `api_server_age.py` - REST API + WebSocket ‚úÖ
- –í—Å–µ 9 endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã ‚úÖ

---

## ‚è≥ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (‚è≥ 1-2 —á–∞—Å–∞)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r scripts/migration-requirements.txt

# –°–æ–∑–¥–∞—Ç—å SSH —Ç—É–Ω–Ω–µ–ª–∏
ssh -L 8529:localhost:8529 vuege-server -N &  # ArangoDB
ssh -L 5432:localhost:5432 vuege-server -N &  # PostgreSQL

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python3 scripts/migrate-arango-to-age.py \
    --arango-password "fedoc_test_2025" \
    --pg-password "fedoc_test_2025" \
    --export-mapping ./id-mapping.json
```

### –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (‚è≥ 30 –º–∏–Ω—É—Ç)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä (–ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å)
cd src/lib/graph_viewer/backend
python3 api_server_age.py \
    --db-host localhost \
    --db-port 5432 \
    --db-password "fedoc_test_2025" &

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python3 scripts/test-age-api.py
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å Graph Viewer frontend (‚è≥ 2-3 —á–∞—Å–∞)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ bigint ID –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å WebSocket

### –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ production (‚è≥ 1 —á–∞—Å)

**–ü–ª–∞–Ω:**
1. –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
2. –ó–∞–º–µ–Ω–∞ `api_server.py` ‚Üí `api_server_age.py`
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Graph Viewer
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ rollback plan

### –®–∞–≥ 5: –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è ArangoDB (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ production –º–æ–∂–Ω–æ:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ArangoDB
- –°–æ–∑–¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø
- –û—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 1. –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ ‚úÖ
- Docker –æ–±—Ä–∞–∑ —Å AGE
- SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- Python API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–æ–º

### 2. –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ –ë–î ‚úÖ
- –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (stub –≤–µ—Ä—Å–∏–∏ –≤ SQL, –ø–æ–ª–Ω—ã–µ –≤ Python)
- Cypher –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ AQL
- PostgreSQL triggers –∏ constraints (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

### 3. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚úÖ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `arango_key` –∫–∞–∫ —Å–≤–æ–π—Å—Ç–≤–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö ID –≤ API
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∫ ArangoDB

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚úÖ
- PostgreSQL 16.10 - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- AGE –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≥—Ä–∞—Ñ–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ SQL - –∑–∞–≥–ª—É—à–∫–∏

**–¢–µ–∫—É—â–µ–µ:** –§—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏ –≤ `04-validation-functions.sql`  
**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–æ–∂–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—ã–∑–æ–≤–∞ cypher() –∏–∑ PL/pgSQL  
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ Python (`edge_validator_age.py`)

### 2. ID –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ ID –≤–∏–¥–∞ `"canonical_nodes/c:backend"`  
**AGE –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:** bigint ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `844424930131969`)  
**–†–µ—à–µ–Ω–∏–µ:** 
- –°–æ—Ö—Ä–∞–Ω–µ–Ω `arango_key` –∫–∞–∫ —Å–≤–æ–π—Å—Ç–≤–æ
- API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞
- –ú–∞–ø–ø–∏–Ω–≥ ID —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### 3. –í–µ—Ä—Å–∏—è AGE

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** PG16/v1.6.0-rc0 (release candidate)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ stable –≤–µ—Ä—Å–∏—é –∫–æ–≥–¥–∞ –≤—ã–π–¥–µ—Ç  
**–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** RC0 –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–∞–±–∏–ª–µ–Ω –¥–ª—è production

---

## üî• –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ production

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω
- [x] PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] AGE —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã

### –ö–æ–¥
- [x] API endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] Edge validator —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Frontend –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Production
- [ ] –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø ArangoDB
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] Rollback –ø–ª–∞–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üéì –£—Ä–æ–∫–∏

### –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –æ—Ç–ª–∏—á–Ω–æ

1. ‚úÖ **–ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥**
   - –°–Ω–∞—á–∞–ª–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø–æ—Ç–æ–º –∫–æ–¥
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
   - –ö–æ–º–º–∏—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ —à–∞–≥–∞

2. ‚úÖ **Pragmatic —Ä–µ—à–µ–Ω–∏—è**
   - –§—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ SQL
   - –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ Python –∫–æ–¥–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–∫

3. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - 6 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –ü—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —à–∞–≥—É

4. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ arango_key
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ ID
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞ 1:** AGE –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ postgres:16-alpine  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–±—Ä–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Docker –æ–±—Ä–∞–∑ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞ 2:** –°–ª–æ–∂–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ Cypher –∏–∑ PL/pgSQL  
**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ Python –∫–æ–¥–µ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞ 3:** –û—Ç–ª–∏—á–∏—è agtype –æ—Ç JSON  
**–†–µ—à–µ–Ω–∏–µ:** Helper —Ñ—É–Ω–∫—Ü–∏—è `agtype_to_python()` ‚úÖ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ö–æ–¥

| –ú–µ—Ç—Ä–∏–∫–∞ | ArangoDB | PostgreSQL+AGE | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|----------|----------------|-----------|
| API —Å–µ—Ä–≤–µ—Ä | 683 —Å—Ç—Ä–æ–∫ | 682 —Å—Ç—Ä–æ–∫ | -1 —Å—Ç—Ä–æ–∫–∞ |
| Edge validator | 229 —Å—Ç—Ä–æ–∫ | 292 —Å—Ç—Ä–æ–∫ | +63 —Å—Ç—Ä–æ–∫–∏ |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | python-arango | psycopg2 | –ó–∞–º–µ–Ω–∞ |
| –¢–∏–ø –ë–î | NoSQL | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è + –ì—Ä–∞—Ñ | –ì–∏–±—Ä–∏–¥ |

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ | –ü–æ—Å–ª–µ |
|-----------|-----|-------|
| –û–±—Ä–∞–∑ –ë–î | arangodb:3.11 | fedoc/postgres-age:16-1.6.0 |
| –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ | ~500 MB | ~300 MB |
| –ò–Ω–∏—Ç —Å–∫—Ä–∏–ø—Ç–æ–≤ | 0 | 5 SQL —Ñ–∞–π–ª–æ–≤ |
| –§—É–Ω–∫—Ü–∏–∏ –≤ –ë–î | 0 | 4 —Ñ—É–Ω–∫—Ü–∏–∏ |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| MIGRATION-SUMMARY.md | 180 | –û–±–∑–æ—Ä |
| MIGRATION-GUIDE.md | 450 | –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ |
| AQL-TO-CYPHER-MAPPING.md | 400 | –ü—Ä–∏–º–µ—Ä—ã |
| SUCCESS-REPORT.md | 300 | –û—Ç—á–µ—Ç |
| FINAL-SUMMARY.md | 350 | –ò—Ç–æ–≥–∏ |
| BUILD-POSTGRES-AGE.md | 120 | Docker |

**–ò—Ç–æ–≥–æ:** ~1800 —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```bash
# 1. –°–æ–∑–¥–∞—Ç—å SSH —Ç—É–Ω–Ω–µ–ª–∏
ssh -L 8529:localhost:8529 vuege-server -N &
ssh -L 5432:localhost:5432 vuege-server -N &

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r scripts/migration-requirements.txt

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python3 scripts/migrate-arango-to-age.py \
    --arango-host http://localhost:8529 \
    --arango-password "fedoc_test_2025" \
    --pg-host localhost \
    --pg-port 5432 \
    --pg-password "fedoc_test_2025" \
    --export-mapping ./id-mapping.json

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
ssh vuege-server "docker exec fedoc-postgres psql -U postgres -d fedoc -c \"
    LOAD 'age';
    SET search_path = ag_catalog, public;
    SELECT * FROM cypher('common_project_graph', \\$\\$
        MATCH (n) RETURN count(n)
    \\$\\$) as (cnt agtype);
\""
```

### –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å)
cd src/lib/graph_viewer/backend
python3 api_server_age.py \
    --db-host localhost \
    --db-port 5432 \
    --db-password "fedoc_test_2025" \
    --port 8899

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
# TODO: –î–æ–±–∞–≤–∏—Ç—å –≤ config/graph_viewer.yaml –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç API endpoints
python3 scripts/test-age-api.py

# –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (dry-run)
python3 scripts/migrate-arango-to-age.py \
    --arango-password "..." \
    --pg-password "..." \
    --no-validation  # –ë–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–±—ã—Å—Ç—Ä–µ–µ)
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç—å `migrate-arango-to-age.py` –∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

–ó–∞–ø—É—Å—Ç–∏—Ç—å `api_server_age.py` –∏ `test-age-api.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö endpoints.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û–±–Ω–æ–≤–∏—Ç—å `config/graph_viewer.yaml` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PostgreSQL:

```yaml
# –°–µ–∫—Ü–∏—è –¥–ª—è PostgreSQL (–Ω–æ–≤–∞—è)
postgres:
  host: "localhost"  # –ß–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å
  port: 5432
  database: "fedoc"
  user: "postgres"
  password_env: "POSTGRES_PASSWORD"

# –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ë–î
database:
  type: "postgresql"  # "arangodb" –∏–ª–∏ "postgresql"
  graph_name: "common_project_graph"
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

**–°—Ç–∞—Ç—É—Å:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω, –±–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** 80%

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:** –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ**

–í—ã —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ fedoc —Å ArangoDB Community –Ω–∞ PostgreSQL + Apache AGE!

**–ê–≤—Ç–æ—Ä:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä + Claude  
**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è:** 21:20 UTC

