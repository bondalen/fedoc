-- ============================================================================
-- Инициализация Apache AGE для проекта fedoc
-- PostgreSQL 16.10 + Apache AGE 1.6.0
-- ============================================================================

\echo '================================================'
\echo 'Инициализация Apache AGE для fedoc'
\echo '================================================'

-- Создать базу данных fedoc (если еще не создана)
-- Примечание: Этот скрипт запускается в контексте postgres database
-- После создания БД нужно переподключиться к ней

\echo '1. Создание базы данных fedoc...'

-- Проверить существование базы данных
SELECT 'База данных fedoc уже существует' 
WHERE EXISTS (SELECT FROM pg_database WHERE datname = 'fedoc');

-- Создать базу данных если не существует
-- Примечание: CREATE DATABASE нельзя выполнить в блоке DO $$ или функции
-- Используем psql команду с игнорированием ошибки если БД уже существует

SELECT 'CREATE DATABASE fedoc' WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'fedoc') \gexec

-- Альтернативный способ (будет ошибка если БД существует, но это OK):
-- CREATE DATABASE IF NOT EXISTS поддерживается только в некоторых версиях PostgreSQL
-- В PostgreSQL 16.10 можно использовать:
-- CREATE DATABASE fedoc (выдаст ошибку если существует, но скрипт продолжит работу)

\echo '✓ База данных fedoc готова'
\echo ''

